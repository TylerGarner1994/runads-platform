<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RunAds - Landing Page & Ad Generation Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{
margin:0;
padding:0;
box-sizing:border-box;
}
body{
font-family:'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
background-color:#f1f5f9;
color:#1e293b;
-webkit-font-smoothing:antialiased;
-moz-osx-font-smoothing:grayscale;
}
.layout{
display:flex;
height:100vh;
}
.sidebar{
width:280px;
background:linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
color:white;
padding:0;
display:flex;
flex-direction:column;
border-right:none;
overflow-y:auto;
box-shadow:4px 0 24px rgba(0,0,0,0.15);
}
.sidebar-logo{
padding:24px 20px;
font-size:22px;
font-weight:700;
letter-spacing:-0.5px;
border-bottom:1px solid rgba(255,255,255,0.06);
background:linear-gradient(135deg, #6366f1, #8b5cf6);
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
background-clip:text;
}
.sidebar-section{
padding:12px 0;
}
.sidebar-section-title{
padding:12px 20px;
font-size:10px;
font-weight:700;
text-transform:uppercase;
letter-spacing:1px;
color:#64748b;
}
.sidebar-item{
padding:10px 20px;
cursor:pointer;
display:flex;
align-items:center;
gap:12px;
font-size:14px;
transition:all 0.15s ease;
border-left:3px solid transparent;
border-radius:0 8px 8px 0;
margin-right:8px;
color:#94a3b8;
}
.sidebar-item:hover{
background-color:rgba(99,102,241,0.08);
color:#e2e8f0;
}
.sidebar-item.active{
background:linear-gradient(135deg, rgba(99,102,241,0.15), rgba(139,92,246,0.1));
border-left-color:#6366f1;
color:#fff;
font-weight:500;
}
.sidebar-item-icon{
font-size:18px;
min-width:24px;
}
.sidebar-footer{
margin-top:auto;
padding:16px 20px;
border-top:1px solid rgba(255,255,255,0.06);
font-size:11px;
color:#475569;
text-align:center;
letter-spacing:0.3px;
}
.main-content{
flex:1;
display:flex;
flex-direction:column;
overflow:hidden;
}
.header{
background-color:#ffffff;
border-bottom:1px solid #e2e8f0;
padding:20px 32px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 1px 3px rgba(0,0,0,0.04);
}
.header-title{
font-size:26px;
font-weight:700;
letter-spacing:-0.3px;
color:#0f172a;
}
.header-actions{
display:flex;
gap:12px;
align-items:center;
}
.content-area{
flex:1;
overflow-y:auto;
padding:32px;
}
.btn{
padding:10px 18px;
border-radius:10px;
font-size:14px;
font-weight:500;
border:none;
cursor:pointer;
transition:all 0.15s ease;
display:inline-flex;
align-items:center;
gap:8px;
letter-spacing:0.01em;
}
.btn-primary{
background:linear-gradient(135deg, #6366f1, #4f46e5);
color:white;
box-shadow:0 1px 3px rgba(99,102,241,0.3);
}
.btn-primary:hover{
background:linear-gradient(135deg, #4f46e5, #4338ca);
box-shadow:0 4px 12px rgba(99,102,241,0.35);
transform:translateY(-1px);
}
.btn-secondary{
background-color:#f8fafc;
color:#334155;
border:1px solid #e2e8f0;
}
.btn-secondary:hover{
background-color:#f1f5f9;
border-color:#cbd5e1;
}
.btn-danger{
background-color:#ef4444;
color:white;
}
.btn-danger:hover{
background-color:#dc2626;
}
.btn-small{
padding:6px 12px;
font-size:13px;
}
.btn-icon{
padding:8px;
font-size:16px;
background:none;
border:none;
cursor:pointer;
color:#6b7280;
transition:color 0.2s ease;
}
.btn-icon:hover{
color:#2563eb;
}
.stats-grid{
display:grid;
grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
gap:20px;
margin-bottom:32px;
}
.stat-card{
background-color:#ffffff;
border:1px solid #e2e8f0;
border-radius:14px;
padding:22px;
transition:all 0.2s ease;
box-shadow:0 1px 3px rgba(0,0,0,0.04);
}
.stat-card:hover{
box-shadow:0 4px 12px rgba(0,0,0,0.08);
transform:translateY(-1px);
}
.stat-label{
font-size:11px;
font-weight:700;
text-transform:uppercase;
color:#64748b;
margin-bottom:10px;
letter-spacing:0.8px;
}
.stat-value{
font-size:30px;
font-weight:700;
color:#0f172a;
letter-spacing:-0.5px;
}
.stat-change{
font-size:12px;
color:#10b981;
margin-top:8px;
font-weight:500;
}
.table-container{
background-color:#ffffff;
border:1px solid #e2e8f0;
border-radius:14px;
overflow:hidden;
box-shadow:0 1px 3px rgba(0,0,0,0.04);
}
table{
width:100%;
border-collapse:collapse;
}
thead{
background-color:#f8fafc;
border-bottom:1px solid #e2e8f0;
}
th{
padding:12px 16px;
text-align:left;
font-size:11px;
font-weight:700;
text-transform:uppercase;
color:#64748b;
letter-spacing:0.8px;
}
td{
padding:14px 16px;
border-bottom:1px solid #f1f5f9;
font-size:14px;
color:#334155;
}
tbody tr{
transition:background-color 0.15s ease;
}
tbody tr:hover{
background-color:#f8fafc;
}
tbody tr:last-child td{
border-bottom:none;
}
.badge{
display:inline-block;
padding:4px 12px;
border-radius:20px;
font-size:12px;
font-weight:500;
}
.badge-success{
background-color:#d1fae5;
color:#065f46;
}
.badge-gray{
background-color:#f3f4f6;
color:#374151;
}
.badge-blue{
background-color:#dbeafe;
color:#1e40af;
}
.form-group{
margin-bottom:16px;
}
label{
display:block;
font-size:14px;
font-weight:500;
margin-bottom:6px;
color:#1f2937;
}
input[type="text"],
input[type="email"],
input[type="number"],
input[type="url"],
textarea,
select{
width:100%;
padding:10px 14px;
border:1px solid #e2e8f0;
border-radius:10px;
font-size:14px;
font-family:inherit;
transition:all 0.15s ease;
background:#fff;
color:#1e293b;
}
input[type="text"]:focus,
input[type="email"]:focus,
input[type="number"]:focus,
input[type="url"]:focus,
textarea:focus,
select:focus{
outline:none;
border-color:#6366f1;
box-shadow:0 0 0 3px rgba(99, 102, 241, 0.1);
}
textarea{
resize:vertical;
min-height:100px;
}
.modal-overlay{
display:none;
position:fixed;
top:0;
left:0;
right:0;
bottom:0;
background-color:rgba(0, 0, 0, 0.5);
z-index:1000;
align-items:center;
justify-content:center;
}
.modal-overlay.active{
display:flex;
}
.modal{
background-color:#ffffff;
border-radius:16px;
box-shadow:0 25px 50px -12px rgba(0, 0, 0, 0.15);
max-width:900px;
width:90%;
max-height:90vh;
overflow-y:auto;
}
.modal-header{
padding:24px;
border-bottom:1px solid #f1f5f9;
display:flex;
justify-content:space-between;
align-items:center;
}
.modal-header-title{
font-size:20px;
font-weight:700;
color:#0f172a;
letter-spacing:-0.2px;
}
.modal-close{
background:none;
border:none;
font-size:24px;
cursor:pointer;
color:#6b7280;
}
.modal-body{
padding:24px;
}
.modal-footer{
padding:24px;
border-top:1px solid #e5e7eb;
display:flex;
justify-content:flex-end;
gap:12px;
}
.cards-grid{
display:grid;
grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));
gap:16px;
margin-bottom:24px;
}
.card-option{
background-color:#ffffff;
border:2px solid #e2e8f0;
border-radius:14px;
padding:20px;
text-align:center;
cursor:pointer;
transition:all 0.15s ease;
}
.card-option:hover{
border-color:#6366f1;
box-shadow:0 4px 16px rgba(99,102,241,0.12);
transform:translateY(-2px);
}
.card-option.selected{
border-color:#6366f1;
background:linear-gradient(135deg, #f5f3ff, #eef2ff);
box-shadow:0 2px 8px rgba(99,102,241,0.15);
}
.card-option-icon{
font-size:32px;
margin-bottom:12px;
}
.card-option-title{
font-size:15px;
font-weight:600;
margin-bottom:4px;
}
.card-option-desc{
font-size:12px;
color:#6b7280;
}
.tabs{
display:flex;
gap:0;
border-bottom:1px solid #e2e8f0;
margin-bottom:24px;
}
.tab{
padding:12px 18px;
cursor:pointer;
font-size:13px;
font-weight:500;
color:#64748b;
border-bottom:2px solid transparent;
transition:all 0.15s ease;
letter-spacing:0.01em;
}
.tab:hover{
color:#334155;
}
.tab.active{
color:#6366f1;
border-bottom-color:#6366f1;
font-weight:600;
}
.tab-content{
display:none;
}
.tab-content.active{
display:block;
}
.loading{
display:inline-block;
width:20px;
height:20px;
border:3px solid #e2e8f0;
border-top-color:#6366f1;
border-radius:50%;
animation:spin 0.8s linear infinite;
}
.pipeline-step{
display:flex;
align-items:center;
gap:12px;
padding:8px 12px;
opacity:0.5;
transition:all 0.3s ease;
}
.pipeline-step .step-icon{font-size:18px;}
.pipeline-step .step-label{flex:1;font-size:14px;font-weight:500;}
.pipeline-step .step-status{font-size:13px;color:#666;min-width:80px;text-align:right;
}
@keyframes spin{
to{transform:rotate(360deg);}
}
.alert{
padding:12px 16px;
border-radius:8px;
margin-bottom:16px;
font-size:14px;
}
.alert-success{
background-color:#d1fae5;
color:#065f46;
border:1px solid #a7f3d0;
}
.alert-error{
background-color:#fee2e2;
color:#991b1b;
border:1px solid #fecaca;
}
.two-column{
display:grid;
grid-template-columns:1fr 1fr;
gap:20px;
}
.three-column{
display:grid;
grid-template-columns:repeat(3, 1fr);
gap:16px;
}
.color-input-group{
display:flex;
align-items:center;
gap:8px;
}
.color-input-group input[type="color"]{
width:50px;
height:40px;
border:1px solid #e5e7eb;
border-radius:8px;
cursor:pointer;
}
.color-input-group input[type="text"]{
flex:1;
}
.hidden{
display:none !important;
}
@media (max-width:1024px){
.sidebar{
width:240px;
}
.stats-grid{
grid-template-columns:repeat(2, 1fr);
}
.two-column{
grid-template-columns:1fr;
}
}
@media (max-width:768px){
.layout{
flex-direction:column;
}
.sidebar{
width:100%;
height:auto;
max-height:60px;
flex-direction:row;
align-items:center;
padding:0 20px;
}
.sidebar-logo{
padding:0;
border:none;
}
.sidebar-section{
display:none;
}
.sidebar-footer{
display:none;
}
.header{
padding:16px;
}
.content-area{
padding:16px;
}
.stats-grid{
grid-template-columns:1fr;
}
.modal{
width:95%;
}
}
.split-view{
display:grid;
grid-template-columns:1fr 1fr;
gap:16px;
height:500px;
}
.split-pane{
display:flex;
flex-direction:column;
border:1px solid #e5e7eb;
border-radius:8px;
overflow:hidden;
}
.split-pane-header{
padding:12px 16px;
border-bottom:1px solid #e5e7eb;
background-color:#f9fafb;
font-weight:500;
font-size:13px;
}
.split-pane-content{
flex:1;
overflow:hidden;
}
textarea.code-editor{
width:100%;
height:100%;
padding:12px;
border:none;
font-family:'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
font-size:12px;
resize:none;
}
iframe.preview{
width:100%;
height:100%;
border:none;
}
.toolbar{
display:flex;
gap:4px;
padding:12px;
border-bottom:1px solid #e5e7eb;
background-color:#f9fafb;
flex-wrap:wrap;
}
.toolbar-group{
display:flex;
gap:4px;
padding-right:8px;
border-right:1px solid #e5e7eb;
}
.toolbar-group:last-child{
border-right:none;
}
.chart-bar{
display:flex;
align-items:flex-end;
gap:8px;
height:200px;
margin-bottom:16px;
}
.chart-bar-item{
flex:1;
display:flex;
flex-direction:column;
align-items:center;
gap:8px;
}
.chart-bar-value{
background-color:#2563eb;
border-radius:4px 4px 0 0;
width:100%;
transition:all 0.2s ease;
}
.chart-bar-value:hover{
background-color:#1d4ed8;
}
.chart-bar-label{
font-size:12px;
color:#6b7280;
}
.client-detail{
background-color:#ffffff;
border-left:1px solid #e5e7eb;
overflow-y:auto;
}
.client-header{
padding:24px;
border-bottom:1px solid #e5e7eb;
}
.client-name{
font-size:22px;
font-weight:700;
margin-bottom:4px;
}
.client-website{
font-size:13px;
color:#6b7280;
}
.client-content{
padding:24px;
}
.multiselect-container{
display:grid;
grid-template-columns:repeat(auto-fill, minmax(120px, 1fr));
gap:8px;
margin-bottom:16px;
}
.multiselect-item{
display:flex;
align-items:center;
gap:8px;
padding:8px 12px;
border:1px solid #e5e7eb;
border-radius:6px;
cursor:pointer;
transition:all 0.2s ease;
background-color:#ffffff;
}
.multiselect-item:hover{
border-color:#2563eb;
}
.multiselect-item input[type="checkbox"]{
cursor:pointer;
}
.multiselect-item.selected{
border-color:#2563eb;
background-color:#eff6ff;
}
.flex-between{
display:flex;
justify-content:space-between;
align-items:center;
}
.flex-gap{
display:flex;
gap:8px;
align-items:center;
}
.action-buttons{
display:flex;
gap:8px;
align-items:center;
}
.action-button{
background:none;
border:none;
cursor:pointer;
font-size:16px;
padding:4px;
transition:transform 0.2s ease;
}
.action-button:hover{
transform:scale(1.2);
}
.steps{
display:flex;
justify-content:space-between;
margin-bottom:32px;
position:relative;
}
.steps::before{
content:'';
position:absolute;
top:20px;
left:0;
right:0;
height:2px;
background-color:#e5e7eb;
z-index:-1;
}
.step{
display:flex;
flex-direction:column;
align-items:center;
gap:8px;
}
.step-number{
width:40px;
height:40px;
background-color:#f3f4f6;
border:2px solid #e5e7eb;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-weight:600;
transition:all 0.2s ease;
}
.step.active .step-number{
background:linear-gradient(135deg, #6366f1, #4f46e5);
color:white;
border-color:#6366f1;
box-shadow:0 2px 8px rgba(99,102,241,0.3);
}
.step.completed .step-number{
background-color:#10b981;
border-color:#10b981;
color:white;
}
.step-label{
font-size:13px;
font-weight:500;
color:#64748b;
}
.step.active .step-label{
color:#6366f1;
font-weight:600;
}
.chat-panel{
position:fixed;
right:0;
bottom:0;
width:400px;
height:500px;
background-color:#ffffff;
border:1px solid #e5e7eb;
border-top-left-radius:12px;
display:none;
flex-direction:column;
z-index:999;
box-shadow:0 20px 25px -5px rgba(0, 0, 0, 0.1);
}
.chat-panel.active{
display:flex;
}
.chat-header{
padding:16px;
border-bottom:1px solid #e5e7eb;
display:flex;
justify-content:space-between;
align-items:center;
}
.chat-messages{
flex:1;
overflow-y:auto;
padding:16px;
display:flex;
flex-direction:column;
gap:12px;
}
.chat-message{
display:flex;
gap:8px;
font-size:13px;
line-height:1.4;
}
.chat-message.user{
justify-content:flex-end;
}
.chat-message-bubble{
max-width:70%;
padding:10px 12px;
border-radius:8px;
word-wrap:break-word;
}
.chat-message.assistant .chat-message-bubble{
background-color:#f3f4f6;
color:#1f2937;
}
.chat-message.user .chat-message-bubble{
background-color:#2563eb;
color:white;
}
.chat-input-area{
padding:12px;
border-top:1px solid #e5e7eb;
display:flex;
gap:8px;
}
.chat-input-area input{
flex:1;
padding:8px 12px;
border:1px solid #e5e7eb;
border-radius:6px;
font-size:13px;
}
.chat-input-area button{
padding:8px 12px;
background-color:#2563eb;
color:white;
border:none;
border-radius:6px;
cursor:pointer;
font-size:13px;
}
.text-center{
text-align:center;
}
.text-muted{
color:#6b7280;
}
.mb-4{
margin-bottom:16px;
}
.gap-2{
gap:8px;
}
.mt-4{
margin-top:16px;
}
</style>
</head>
<body>
<div class="layout">
<aside class="sidebar">
<div class="sidebar-logo">RUNADS <span style="font-size:11px;font-weight:500;opacity:0.6;-webkit-text-fill-color:rgba(255,255,255,0.5);background:none;">v3.0</span></div>
<div class="sidebar-section">
<div class="sidebar-section-title">Main</div>
<div class="sidebar-item active" data-view="dashboard">
<span class="sidebar-item-icon">üìä</span>
<span>Dashboard</span>
</div>
<div class="sidebar-item" data-view="landing-pages">
<span class="sidebar-item-icon">üìÑ</span>
<span>Landing Pages</span>
</div>
</div>
<div class="sidebar-section">
<div class="sidebar-section-title">Clients</div>
<div class="sidebar-item" data-view="all-clients">
<span class="sidebar-item-icon">üë•</span>
<span>All Clients</span>
</div>
<div class="sidebar-item" data-view="add-client-form">
<span class="sidebar-item-icon">‚ûï</span>
<span>Add Client</span>
</div>
</div>
<div class="sidebar-section">
<div class="sidebar-section-title">Create</div>
<div class="sidebar-item" data-view="generate-page-modal">
<span class="sidebar-item-icon">‚ú®</span>
<span>Generate Page</span>
</div>
<div class="sidebar-item" data-view="import-html-modal">
<span class="sidebar-item-icon">‚ûï</span>
<span>Import HTML</span>
</div>
</div>
<div class="sidebar-section">
<div class="sidebar-section-title">Meta Ads</div>
<div class="sidebar-item" data-view="ad-generator">
<span class="sidebar-item-icon">üì¢</span>
<span>Ad Generator</span>
</div>
</div>
<div class="sidebar-section">
<div class="sidebar-section-title">Analytics</div>
<div class="sidebar-item" data-view="reports">
<span class="sidebar-item-icon">üìà</span>
<span>Reports</span>
</div>
<div class="sidebar-item" data-view="leads">
<span class="sidebar-item-icon">üë§</span>
<span>Leads</span>
</div>
</div>
<div class="sidebar-footer">
<div style="font-weight:500;color:#94a3b8;margin-bottom:4px;">Stand Out Social</div>
<div style="font-size:10px;">Powered by RunAds Platform</div>
</div>
</aside>
<div class="main-content">
<header class="header">
<h1 class="header-title" id="pageTitle">Dashboard</h1>
<div class="header-actions" id="headerActions"></div>
</header>
<div class="content-area" id="contentArea"></div>
</div>
</div>
<div class="modal-overlay" id="generatePageModal">
<div class="modal">
<div class="modal-header">
<h2 class="modal-header-title">Generate Landing Page</h2>
<button class="modal-close" onclick="closeModal('generatePageModal')">‚úï</button>
</div>
<div class="modal-body">
<div style="margin-bottom:24px;">
<label style="margin-bottom:12px;display:block;font-weight:600;">Page Type</label>
<div class="cards-grid">
<div class="card-option" onclick="selectPageType(this, 'advertorial')">
<div class="card-option-icon">üì∞</div>
<div class="card-option-title">Advertorial</div>
<div class="card-option-desc">Editorial-style article</div>
</div>
<div class="card-option" onclick="selectPageType(this, 'listicle')">
<div class="card-option-icon">üìã</div>
<div class="card-option-title">Listicle</div>
<div class="card-option-desc">List-based article</div>
</div>
<div class="card-option" onclick="selectPageType(this, 'quiz')">
<div class="card-option-icon">‚ùì</div>
<div class="card-option-title">Quiz Funnel</div>
<div class="card-option-desc">Interactive quiz</div>
</div>
<div class="card-option" onclick="selectPageType(this, 'vip-signup')">
<div class="card-option-icon">üëë</div>
<div class="card-option-title">VIP Signup</div>
<div class="card-option-desc">VIP email capture</div>
</div>
<div class="card-option" onclick="selectPageType(this, 'calculator')">
<div class="card-option-icon">üßÆ</div>
<div class="card-option-title">Calculator</div>
<div class="card-option-desc">Interactive calculator</div>
</div>
<div class="card-option" onclick="selectPageType(this, 'sales-letter')">
<div class="card-option-icon">üíå</div>
<div class="card-option-title">Sales Letter</div>
<div class="card-option-desc">Direct response letter</div>
</div>
<div class="card-option" onclick="selectPageType(this, 'sms-tips')">
<div class="card-option-icon">üì±</div>
<div class="card-option-title">SMS Tips</div>
<div class="card-option-desc">SMS lead magnet</div>
</div>
</div>
</div>
<div class="form-group">
<label>Product/Offer URL or Description</label>
<input type="text" id="generatePageUrl" placeholder="https://example.com or product description">
</div>
<div class="form-group">
<label>Target Audience</label>
<textarea id="generatePageAudience" placeholder="Describe your target audience..."></textarea>
</div>
<div class="two-column">
<div class="form-group">
<label>Tone & Style</label>
<select id="generatePageTone">
<option value="">Select tone...</option>
<option value="professional">Professional & Trustworthy</option>
<option value="conversational">Conversational & Friendly</option>
<option value="urgent">Urgent & Direct</option>
<option value="playful">Playful & Bold</option>
<option value="authoritative">Authoritative & Expert</option>
</select>
</div>
<div class="form-group">
<label>Client (Optional)</label>
<select id="generatePageClient">
<option value="">No client assigned</option>
</select>
</div>
</div>
</div>
<div id="pipelineProgress" style="display:none;padding:20px;">
<h3 style="margin-bottom:16px;font-size:16px;font-weight:600;">7-Step AI Generation Pipeline</h3>
<div id="pipelineSteps" style="display:flex;flex-direction:column;gap:8px;">
<div class="pipeline-step" data-step="research"><span class="step-icon">üîç</span><span class="step-label">Deep Research</span><span class="step-status">Waiting</span></div>
<div class="pipeline-step" data-step="brand"><span class="step-icon">üé®</span><span class="step-label">Brand Extraction</span><span class="step-status">Waiting</span></div>
<div class="pipeline-step" data-step="strategy"><span class="step-icon">üß†</span><span class="step-label">Page Strategy</span><span class="step-status">Waiting</span></div>
<div class="pipeline-step" data-step="copy"><span class="step-icon">‚úçÔ∏è</span><span class="step-label">Copy Generation</span><span class="step-status">Waiting</span></div>
<div class="pipeline-step" data-step="design"><span class="step-icon">üéØ</span><span class="step-label">Design Generation</span><span class="step-status">Waiting</span></div>
<div class="pipeline-step" data-step="factcheck"><span class="step-icon">‚úÖ</span><span class="step-label">Fact Checking</span><span class="step-status">Waiting</span></div>
<div class="pipeline-step" data-step="assembly"><span class="step-icon">üöÄ</span><span class="step-label">Final Assembly</span><span class="step-status">Waiting</span></div>
</div>
<div id="pipelineProgressBar" style="margin-top:16px;background:#e0e0e0;border-radius:8px;height:8px;overflow:hidden;">
<div id="pipelineProgressFill" style="width:0%;height:100%;background:linear-gradient(90deg,#2563eb,#7c3aed);border-radius:8px;transition:width 0.5s ease;"></div>
</div>
<div id="pipelineStatus" style="margin-top:8px;font-size:13px;color:#666;"></div>
<div id="pipelineCost" style="margin-top:4px;font-size:12px;color:#999;"></div>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" id="generateCancelBtn" onclick="closeModal('generatePageModal')">Cancel</button>
<button class="btn btn-primary" id="generatePageBtn" onclick="generatePage()">
<span>Generate Page</span>
</button>
</div>
</div>
</div>
<div class="modal-overlay" id="importHtmlModal">
<div class="modal">
<div class="modal-header">
<h2 class="modal-header-title">Import HTML</h2>
<button class="modal-close" onclick="closeModal('importHtmlModal')">‚úï</button>
</div>
<div class="modal-body">
<div class="form-group">
<label>Page Name</label>
<input type="text" id="importPageName" placeholder="My Landing Page">
</div>
<div class="form-group">
<label>Client (Optional)</label>
<select id="importClient">
<option value="">No client assigned</option>
</select>
</div>
<div class="form-group">
<label>HTML Code</label>
<textarea id="importHtmlCode" placeholder="Paste your HTML code here..." style="min-height:300px;"></textarea>
</div>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" onclick="closeModal('importHtmlModal')">Cancel</button>
<button class="btn btn-primary" id="importHtmlBtn" onclick="importHtml()">Import & Deploy</button>
</div>
</div>
</div>
<div class="modal-overlay" id="editPageModal">
<div class="modal" style="max-width:1200px;">
<div class="modal-header">
<h2 class="modal-header-title">Edit Page HTML</h2>
<button class="modal-close" onclick="closeModal('editPageModal')">‚úï</button>
</div>
<div class="modal-body">
<div style="margin-bottom:16px;">
<div class="toolbar">
<div class="toolbar-group">
<button class="btn btn-icon" title="Bold"><strong>B</strong></button>
<button class="btn btn-icon" title="Italic"><em>I</em></button>
<button class="btn btn-icon" title="Heading">H1</button>
</div>
<div class="toolbar-group">
<button class="btn btn-icon" title="Link">üîó</button>
<button class="btn btn-icon" title="Image">üñºÔ∏è</button>
<button class="btn btn-icon" title="Color">üé®</button>
</div>
</div>
</div>
<div class="split-view">
<div class="split-pane">
<div class="split-pane-header">HTML Editor</div>
<div class="split-pane-content">
<textarea id="htmlEditorCode" class="code-editor"></textarea>
</div>
</div>
<div class="split-pane">
<div class="split-pane-header">Preview</div>
<div class="split-pane-content">
<iframe id="htmlEditorPreview" class="preview"></iframe>
</div>
</div>
</div>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" onclick="closeModal('editPageModal')">Cancel</button>
<button class="btn btn-primary" id="editPageSaveBtn" onclick="savePage()">Save & Deploy</button>
</div>
</div>
</div>
<div class="modal-overlay" id="pageAnalyticsModal">
<div class="modal">
<div class="modal-header">
<h2 class="modal-header-title">Page Analytics</h2>
<button class="modal-close" onclick="closeModal('pageAnalyticsModal')">‚úï</button>
</div>
<div class="modal-body">
<div style="margin-bottom:24px;">
<label style="margin-bottom:8px;display:block;">Time Period</label>
<div style="display:flex;gap:8px;">
<button class="btn btn-secondary btn-small" onclick="setAnalyticsPeriod('7d')">7 Days</button>
<button class="btn btn-secondary btn-small" onclick="setAnalyticsPeriod('30d')">30 Days</button>
<button class="btn btn-secondary btn-small" onclick="setAnalyticsPeriod('90d')">90 Days</button>
<button class="btn btn-secondary btn-small" onclick="setAnalyticsPeriod('all')">All Time</button>
</div>
</div>
<div style="margin-bottom:32px;">
<h3 style="margin-bottom:16px;font-size:16px;font-weight:600;">Views Over Time</h3>
<div class="chart-bar" id="viewsChart"></div>
</div>
<div style="margin-bottom:32px;">
<h3 style="margin-bottom:16px;font-size:16px;font-weight:600;">Leads Over Time</h3>
<div class="chart-bar" id="leadsChart"></div>
</div>
<div class="two-column">
<div>
<h3 style="margin-bottom:16px;font-size:16px;font-weight:600;">Top Traffic Sources</h3>
<table style="width:100%;font-size:13px;">
<thead>
<tr style="border-bottom:1px solid #e5e7eb;">
<th style="text-align:left;padding:8px 0;">Source</th>
<th style="text-align:right;padding:8px 0;">Visits</th>
</tr>
</thead>
<tbody id="trafficSourcesTable">
</tbody>
</table>
</div>
<div>
<h3 style="margin-bottom:16px;font-size:16px;font-weight:600;">Device Breakdown</h3>
<table style="width:100%;font-size:13px;">
<thead>
<tr style="border-bottom:1px solid #e5e7eb;">
<th style="text-align:left;padding:8px 0;">Device</th>
<th style="text-align:right;padding:8px 0;">%</th>
</tr>
</thead>
<tbody id="deviceTable">
<tr><td style="padding:8px 0;">Desktop</td><td style="text-align:right;">65%</td></tr>
<tr><td style="padding:8px 0;">Mobile</td><td style="text-align:right;">30%</td></tr>
<tr><td style="padding:8px 0;">Tablet</td><td style="text-align:right;">5%</td></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="modal-overlay" id="qualityReviewModal">
<div class="modal" style="max-width:700px;">
<div class="modal-header">
<h2 class="modal-header-title">‚≠ê Quality Review</h2>
<button class="modal-close" onclick="closeModal('qualityReviewModal')">‚úï</button>
</div>
<div class="modal-body">
<p style="color:#64748b;font-size:14px;margin-bottom:20px;">Review this page's output quality. Your feedback helps improve future generations.</p>
<div id="qualityReviewContent">
<div style="margin-bottom:24px;">
<h3 style="font-size:15px;font-weight:600;margin-bottom:12px;">Overall Quality Score</h3>
<div id="qualityStars" style="display:flex;gap:8px;margin-bottom:8px;">
<button onclick="setQualityRating(1)" class="quality-star" style="font-size:28px;background:none;border:none;cursor:pointer;opacity:0.3;">‚≠ê</button>
<button onclick="setQualityRating(2)" class="quality-star" style="font-size:28px;background:none;border:none;cursor:pointer;opacity:0.3;">‚≠ê</button>
<button onclick="setQualityRating(3)" class="quality-star" style="font-size:28px;background:none;border:none;cursor:pointer;opacity:0.3;">‚≠ê</button>
<button onclick="setQualityRating(4)" class="quality-star" style="font-size:28px;background:none;border:none;cursor:pointer;opacity:0.3;">‚≠ê</button>
<button onclick="setQualityRating(5)" class="quality-star" style="font-size:28px;background:none;border:none;cursor:pointer;opacity:0.3;">‚≠ê</button>
</div>
<div id="qualityRatingLabel" style="font-size:13px;color:#64748b;"></div>
</div>
<div style="margin-bottom:20px;">
<h3 style="font-size:15px;font-weight:600;margin-bottom:12px;">Category Scores</h3>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
<div class="form-group">
<label style="font-size:13px;">Headline Impact</label>
<select id="qHeadline" style="padding:8px 10px;font-size:13px;">
<option value="">‚Äî Rate ‚Äî</option>
<option value="5">Excellent ‚Äî Compelling, scroll-stopping</option>
<option value="4">Good ‚Äî Strong, on-brand</option>
<option value="3">Average ‚Äî Functional but generic</option>
<option value="2">Below Average ‚Äî Weak or off-brand</option>
<option value="1">Poor ‚Äî Confusing or irrelevant</option>
</select>
</div>
<div class="form-group">
<label style="font-size:13px;">Copy Quality</label>
<select id="qCopy" style="padding:8px 10px;font-size:13px;">
<option value="">‚Äî Rate ‚Äî</option>
<option value="5">Excellent ‚Äî Editorial, persuasive</option>
<option value="4">Good ‚Äî Professional, clear</option>
<option value="3">Average ‚Äî Reads like AI, generic</option>
<option value="2">Below Average ‚Äî Repetitive, bland</option>
<option value="1">Poor ‚Äî Factual errors, off-topic</option>
</select>
</div>
<div class="form-group">
<label style="font-size:13px;">Visual Design</label>
<select id="qDesign" style="padding:8px 10px;font-size:13px;">
<option value="">‚Äî Rate ‚Äî</option>
<option value="5">Excellent ‚Äî Professional, modern</option>
<option value="4">Good ‚Äî Clean, well-structured</option>
<option value="3">Average ‚Äî Basic, needs polish</option>
<option value="2">Below Average ‚Äî Cluttered, dated</option>
<option value="1">Poor ‚Äî Broken layout, unreadable</option>
</select>
</div>
<div class="form-group">
<label style="font-size:13px;">Call-to-Action</label>
<select id="qCTA" style="padding:8px 10px;font-size:13px;">
<option value="">‚Äî Rate ‚Äî</option>
<option value="5">Excellent ‚Äî Urgent, compelling</option>
<option value="4">Good ‚Äî Clear, visible</option>
<option value="3">Average ‚Äî Present but generic</option>
<option value="2">Below Average ‚Äî Weak or hidden</option>
<option value="1">Poor ‚Äî Missing or confusing</option>
</select>
</div>
</div>
</div>
<div class="form-group" style="margin-bottom:20px;">
<label style="font-size:13px;">Specific Issues (one per line)</label>
<textarea id="qIssues" rows="3" placeholder="e.g., Headline doesn't match brand voice&#10;Hero image is a placeholder&#10;CTA button text too generic&#10;Missing social proof section"></textarea>
</div>
<div class="form-group" style="margin-bottom:20px;">
<label style="font-size:13px;">What Would Make It Better?</label>
<textarea id="qSuggestions" rows="3" placeholder="e.g., Use more specific statistics&#10;Add real customer testimonials&#10;Make the tone more conversational&#10;Add an ingredient spotlight section"></textarea>
</div>
<div class="form-group" style="margin-bottom:4px;">
<label style="font-size:13px;">Comparison to Unicorn Output</label>
<select id="qUnicornCompare" style="padding:8px 10px;font-size:13px;">
<option value="">‚Äî Select ‚Äî</option>
<option value="better">Better than Unicorn output</option>
<option value="equal">About the same quality</option>
<option value="close">Close, but Unicorn is slightly better</option>
<option value="gap">Noticeable quality gap</option>
<option value="far">Significantly worse than Unicorn</option>
</select>
</div>
</div>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" onclick="closeModal('qualityReviewModal')">Cancel</button>
<button class="btn btn-primary" onclick="submitQualityReview()">Save Review</button>
</div>
</div>
</div>
<div class="chat-panel" id="chatPanel">
<div class="chat-header">
<span style="font-weight:600;">AI Assistant</span>
<button class="modal-close" onclick="toggleChatPanel()" style="padding:0;color:#6b7280;">‚úï</button>
</div>
<div class="chat-messages" id="chatMessages"></div>
<div class="chat-input-area">
<input type="text" id="chatInput" placeholder="Describe changes...">
<button onclick="sendChatMessage()">Send</button>
</div>
</div>
<script>
const app ={
currentView:'dashboard',
currentClient:null,
currentPage:null,
selectedPageType:null,
pages:[],
clients:[],
stats:{
totalPages:0,
livePages:0,
totalViews:0,
totalLeads:0
}
};
document.addEventListener('DOMContentLoaded', () =>{
setupEventListeners();
loadInitialData();
showView('dashboard');
});
function setupEventListeners(){
document.querySelectorAll('[data-view]').forEach(item =>{
item.addEventListener('click', () =>{
const view = item.getAttribute('data-view');
if (view === 'generate-page-modal'){
openModal('generatePageModal');
}else if (view === 'import-html-modal'){
openModal('importHtmlModal');
}else{
updateSidebarActive(item);
showView(view);
}
});
});
}
function updateSidebarActive(element){
document.querySelectorAll('.sidebar-item').forEach(item =>{
item.classList.remove('active');
});
element.classList.add('active');
}
function loadInitialData(){
loadPages();
loadClients();
loadStats();
loadClientsForSelects();
}
function refreshCurrentView(){
if(app.currentView){showView(app.currentView);}
}
function loadPages(){
fetch('/api/pages')
.then(res => res.json())
.then(data =>{
app.pages = data.pages || [];
refreshCurrentView();
})
.catch(err => console.error('Failed to load pages:', err));
}
function loadClients(){
fetch('/api/clients')
.then(res => res.json())
.then(data =>{
app.clients = data.clients || [];
loadClientsForSelects();
})
.catch(err => console.error('Failed to load clients:', err));
}
function loadStats(){
fetch('/api/stats')
.then(res => res.json())
.then(data =>{
app.stats = data;
refreshCurrentView();
})
.catch(err => console.error('Failed to load stats:', err));
}
function loadClientsForSelects(){
setTimeout(() =>{
const selects = document.querySelectorAll('#generatePageClient, #importClient');
selects.forEach(select =>{
select.innerHTML = '<option value="">No client assigned</option>';
app.clients.forEach(client =>{
const option = document.createElement('option');
option.value = client.id;
option.textContent = client.name;
select.appendChild(option);
});
});
}, 500);
}
function showView(viewName){
app.currentView = viewName;
const contentArea = document.getElementById('contentArea');
const headerTitle = document.getElementById('pageTitle');
const headerActions = document.getElementById('headerActions');
contentArea.innerHTML = '';
headerActions.innerHTML = '';
switch (viewName){
case 'dashboard':
headerTitle.textContent = 'Dashboard';
renderDashboard(contentArea, headerActions);
break;
case 'landing-pages':
headerTitle.textContent = 'Landing Pages';
renderLandingPages(contentArea, headerActions);
break;
case 'all-clients':
headerTitle.textContent = 'All Clients';
renderAllClients(contentArea, headerActions);
break;
case 'add-client-form':
headerTitle.textContent = 'Add Client';
renderAddClientForm(contentArea);
break;
case 'ad-generator':
headerTitle.textContent = 'Ad Generator';
renderAdGenerator(contentArea);
break;
case 'reports':
headerTitle.textContent = 'Reports';
renderReports(contentArea);
break;
case 'leads':
headerTitle.textContent = 'Leads';
renderLeads(contentArea, headerActions);
break;
default:
headerTitle.textContent = 'Dashboard';
renderDashboard(contentArea, headerActions);
}
}
function renderDashboard(container, headerActions){
headerActions.innerHTML = `<button class="btn btn-primary" onclick="openModal('generatePageModal')">+ New Page</button>`;
const html = `
<div class="stats-grid">
<div class="stat-card">
<div class="stat-label">Total Pages</div>
<div class="stat-value">${app.stats.totalPages || 0}</div>
</div>
<div class="stat-card">
<div class="stat-label">Live Pages</div>
<div class="stat-value">${app.stats.livePages || 0}</div>
</div>
<div class="stat-card">
<div class="stat-label">Total Views</div>
<div class="stat-value">${(app.stats.totalViews || 0).toLocaleString()}</div>
<div class="stat-change">+12% vs last month</div>
</div>
<div class="stat-card">
<div class="stat-label">Total Leads</div>
<div class="stat-value">${(app.stats.totalLeads || 0).toLocaleString()}</div>
<div class="stat-change">+8% vs last month</div>
</div>
</div>
<div style="margin-bottom:24px;display:flex;justify-content:space-between;align-items:center;">
<h2 style="font-size:20px;font-weight:700;">Landing Pages</h2>
<button class="btn btn-secondary" onclick="loadPages();renderDashboard(document.getElementById('contentArea'), document.getElementById('headerActions'))">üîÑ Refresh</button>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>Name</th>
<th>Client</th>
<th>Status</th>
<th>Views</th>
<th>Leads</th>
<th>Conv.</th>
<th>Score</th>
<th>URL</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="pagesTable">
</tbody>
</table>
</div>
`;
container.innerHTML = html;
renderPagesTable();
}
function renderPagesTable(){
const tbody = document.getElementById('pagesTable');
tbody.innerHTML = '';
if (app.pages.length === 0){
tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:32px;color:#6b7280;">No pages yet. Create one to get started!</td></tr>';
return;
}
app.pages.forEach(page =>{
const conv = page.views > 0 ? ((page.leads / page.views) * 100).toFixed(1):'0';
const row = document.createElement('tr');
row.innerHTML = `
<td><strong>${page.name}</strong></td>
<td>${page.clientName || '‚Äî'}</td>
<td><span class="badge ${page.status === 'live' ? 'badge-success':'badge-gray'}">${page.status === 'live' ? 'Live':'Draft'}</span></td>
<td>${page.views || 0}</td>
<td>${page.leads || 0}</td>
<td>${conv}%</td>
<td>${page.quality_score ? `<span style="color:${page.quality_score >= 4 ? '#10b981' : page.quality_score >= 3 ? '#f59e0b' : '#ef4444'};font-weight:600;">${page.quality_score}/5</span>` : '<span style="color:#cbd5e1;font-size:12px;">‚Äî</span>'}</td>
<td>
<a href="${page.url}" target="_blank" style="color:#6366f1;text-decoration:none;">Vercel ‚Üí</a>
${page.github_pages_url ? `<br><a href="${page.github_pages_url}" target="_blank" style="color:#10b981;text-decoration:none;font-size:12px;">GitHub Pages ‚Üí</a>` : ''}
</td>
<td>
<div class="action-buttons">
<button class="action-button" title="Visual Edit" onclick="editPage('${page.id}')">üé®</button>
<button class="action-button" title="Quality Review" onclick="openQualityReview('${page.id}')">‚≠ê</button>
<button class="action-button" title="Analytics" onclick="viewPageAnalytics('${page.id}')">üìä</button>
<button class="action-button" title="A/B Variants" onclick="generateVariants('${page.id}')">üîÄ</button>
<button class="action-button" title="Edit HTML" onclick="openHtmlEditor('${page.id}')">‚úèÔ∏è</button>
<button class="action-button" title="Delete" onclick="deletePage('${page.id}')">üóëÔ∏è</button>
</div>
</td>
`;
tbody.appendChild(row);
});
}
function renderLandingPages(container, headerActions){
headerActions.innerHTML = `<button class="btn btn-primary" onclick="openModal('generatePageModal')">+ New Page</button>`;
renderDashboard(container, headerActions);
}
function renderAllClients(container, headerActions){
headerActions.innerHTML = `<button class="btn btn-primary" onclick="showView('add-client-form')">+ Add Client</button>`;
const html = `
<div class="table-container">
<table>
<thead>
<tr>
<th>Client Name</th>
<th>Website</th>
<th>Industry</th>
<th>Research Status</th>
<th>Created</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="clientsTable">
</tbody>
</table>
</div>
`;
container.innerHTML = html;
renderClientsTable();
}
function renderClientsTable(){
const tbody = document.getElementById('clientsTable');
tbody.innerHTML = '';
if (app.clients.length === 0){
tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:32px;color:#6b7280;">No clients yet. Add one to get started!</td></tr>';
return;
}
app.clients.forEach(client =>{
const row = document.createElement('tr');
row.innerHTML = `
<td><strong style="cursor:pointer;color:#2563eb;" onclick="viewClientDetail('${client.id}')">${client.name}</strong></td>
<td><a href="${client.website}" target="_blank" style="color:#2563eb;text-decoration:none;font-size:13px;">${client.website || '‚Äî'}</a></td>
<td><span class="badge badge-blue">${client.industry || 'Unknown'}</span></td>
<td><span class="badge ${client.researchStatus === 'complete' ? 'badge-success':'badge-gray'}">${client.researchStatus || 'Pending'}</span></td>
<td style="font-size:13px;color:#6b7280;">${new Date(client.createdAt).toLocaleDateString()}</td>
<td>
<button class="action-button" title="Delete" onclick="deleteClient('${client.id}')">üóëÔ∏è</button>
</td>
`;
tbody.appendChild(row);
});
}
function viewClientDetail(clientId){
const client = app.clients.find(c => c.id === clientId);
if (!client) return;
app.currentClient = client;
const contentArea = document.getElementById('contentArea');
fetch(`/api/clients/${clientId}`)
.then(res => res.json())
.then(data =>{
renderClientDetail(contentArea, data);
})
.catch(err => console.error('Failed to load client:', err));
}
function renderClientDetail(container, client){
const html = `
<div style="display:flex;gap:24px;">
<div style="flex:1;">
<button class="btn btn-secondary btn-small" style="margin-bottom:24px;" onclick="showView('all-clients')">‚Üê Back to Clients</button>
<div style="background-color:#ffffff;border:1px solid #e5e7eb;border-radius:12px;padding:24px;margin-bottom:24px;">
<h2 style="font-size:24px;font-weight:700;margin-bottom:4px;">${client.name}</h2>
<p style="color:#6b7280;font-size:14px;">${client.website || 'No website'}</p>
</div>
<div class="tabs">
<div class="tab active" onclick="switchClientTab(this, 'overview')">Overview</div>
<div class="tab" onclick="switchClientTab(this, 'brand-guide')">Brand Guide</div>
<div class="tab" onclick="switchClientTab(this, 'research')">Research</div>
<div class="tab" onclick="switchClientTab(this, 'verified-facts')">Verified Facts</div>
<div class="tab" onclick="switchClientTab(this, 'assets')">Asset Library</div>
<div class="tab" onclick="switchClientTab(this, 'pages')">Pages</div>
</div>
<div id="clientTabs">
<div id="overview-tab" class="tab-content active">
<div class="stats-grid">
<div class="stat-card">
<div class="stat-label">Total Pages</div>
<div class="stat-value">${client.totalPages || 0}</div>
</div>
<div class="stat-card">
<div class="stat-label">Total Views</div>
<div class="stat-value">${(client.totalViews || 0).toLocaleString()}</div>
</div>
<div class="stat-card">
<div class="stat-label">Total Leads</div>
<div class="stat-value">${(client.totalLeads || 0).toLocaleString()}</div>
</div>
</div>
<div style="background-color:#ffffff;border:1px solid #e5e7eb;border-radius:12px;padding:24px;">
<h3 style="font-size:18px;font-weight:700;margin-bottom:16px;">Value Propositions</h3>
<ul style="list-style:none;padding:0;">
${(client.valuePropositions || []).map(vp => `<li style="padding:8px 0;border-bottom:1px solid #f3f4f6;">‚úì ${vp}</li>`).join('')}
</ul>
</div>
</div>
<div id="brand-guide-tab" class="tab-content hidden">
<div style="background-color:#ffffff;border:1px solid #e5e7eb;border-radius:12px;padding:24px;">
<!-- COLOR PALETTE (5 colors like Unicorn) -->
<h3 style="font-size:18px;font-weight:700;margin-bottom:16px;">Color Palette</h3>
<div style="display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:32px;">
<div class="form-group" style="text-align:center;">
<label style="font-size:12px;">Primary</label>
<input type="color" id="colorPrimary" value="${client.style_guide?.colors?.primary || '#2563eb'}" style="width:100%;height:48px;border:none;border-radius:8px;cursor:pointer;">
<input type="text" id="colorPrimaryHex" value="${client.style_guide?.colors?.primary || '#2563eb'}" style="margin-top:4px;font-size:11px;text-align:center;padding:4px;border:1px solid #e2e8f0;border-radius:4px;width:100%;">
</div>
<div class="form-group" style="text-align:center;">
<label style="font-size:12px;">Secondary</label>
<input type="color" id="colorSecondary" value="${client.style_guide?.colors?.secondary || '#10b981'}" style="width:100%;height:48px;border:none;border-radius:8px;cursor:pointer;">
<input type="text" id="colorSecondaryHex" value="${client.style_guide?.colors?.secondary || '#10b981'}" style="margin-top:4px;font-size:11px;text-align:center;padding:4px;border:1px solid #e2e8f0;border-radius:4px;width:100%;">
</div>
<div class="form-group" style="text-align:center;">
<label style="font-size:12px;">Accent</label>
<input type="color" id="colorAccent" value="${client.style_guide?.colors?.accent || '#f59e0b'}" style="width:100%;height:48px;border:none;border-radius:8px;cursor:pointer;">
<input type="text" id="colorAccentHex" value="${client.style_guide?.colors?.accent || '#f59e0b'}" style="margin-top:4px;font-size:11px;text-align:center;padding:4px;border:1px solid #e2e8f0;border-radius:4px;width:100%;">
</div>
<div class="form-group" style="text-align:center;">
<label style="font-size:12px;">Background</label>
<input type="color" id="colorBackground" value="${client.style_guide?.colors?.background || '#ffffff'}" style="width:100%;height:48px;border:none;border-radius:8px;cursor:pointer;">
<input type="text" id="colorBackgroundHex" value="${client.style_guide?.colors?.background || '#ffffff'}" style="margin-top:4px;font-size:11px;text-align:center;padding:4px;border:1px solid #e2e8f0;border-radius:4px;width:100%;">
</div>
<div class="form-group" style="text-align:center;">
<label style="font-size:12px;">Text</label>
<input type="color" id="colorText" value="${client.style_guide?.colors?.text || '#1e293b'}" style="width:100%;height:48px;border:none;border-radius:8px;cursor:pointer;">
<input type="text" id="colorTextHex" value="${client.style_guide?.colors?.text || '#1e293b'}" style="margin-top:4px;font-size:11px;text-align:center;padding:4px;border:1px solid #e2e8f0;border-radius:4px;width:100%;">
</div>
</div>

<!-- TYPOGRAPHY -->
<h3 style="font-size:18px;font-weight:700;margin-bottom:16px;">Typography</h3>
<div class="two-column" style="margin-bottom:16px;">
<div class="form-group">
<label>Heading Font</label>
<select id="bgHeadingFont">
<option ${client.style_guide?.typography?.headingFont === 'Inter' ? 'selected':''}>Inter</option>
<option ${client.style_guide?.typography?.headingFont === 'Playfair Display' ? 'selected':''}>Playfair Display</option>
<option ${client.style_guide?.typography?.headingFont === 'Poppins' ? 'selected':''}>Poppins</option>
<option ${client.style_guide?.typography?.headingFont === 'Roboto' ? 'selected':''}>Roboto</option>
<option ${client.style_guide?.typography?.headingFont === 'Lora' ? 'selected':''}>Lora</option>
<option ${client.style_guide?.typography?.headingFont === 'Montserrat' ? 'selected':''}>Montserrat</option>
<option ${client.style_guide?.typography?.headingFont === 'Georgia' ? 'selected':''}>Georgia</option>
<option ${client.style_guide?.typography?.headingFont === 'Source Serif Pro' ? 'selected':''}>Source Serif Pro</option>
</select>
<div id="headingFontPreview" style="margin-top:8px;font-size:22px;font-weight:700;color:#1e293b;padding:12px;background:#f8fafc;border-radius:6px;">The Quick Brown Fox</div>
</div>
<div class="form-group">
<label>Body Font</label>
<select id="bgBodyFont">
<option ${client.style_guide?.typography?.bodyFont === 'Inter' ? 'selected':''}>Inter</option>
<option ${client.style_guide?.typography?.bodyFont === 'Roboto' ? 'selected':''}>Roboto</option>
<option ${client.style_guide?.typography?.bodyFont === 'Open Sans' ? 'selected':''}>Open Sans</option>
<option ${client.style_guide?.typography?.bodyFont === 'Lato' ? 'selected':''}>Lato</option>
<option ${client.style_guide?.typography?.bodyFont === 'Nunito' ? 'selected':''}>Nunito</option>
<option ${client.style_guide?.typography?.bodyFont === 'Georgia' ? 'selected':''}>Georgia</option>
<option ${client.style_guide?.typography?.bodyFont === 'Source Sans Pro' ? 'selected':''}>Source Sans Pro</option>
</select>
<div id="bodyFontPreview" style="margin-top:8px;font-size:14px;line-height:1.6;color:#475569;padding:12px;background:#f8fafc;border-radius:6px;">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore.</div>
</div>
</div>

<!-- SPACING & LAYOUT -->
<h3 style="font-size:18px;font-weight:700;margin-bottom:16px;margin-top:24px;">Spacing & Layout</h3>
<div class="three-column" style="margin-bottom:16px;">
<div class="form-group">
<label>Border Radius</label>
<select id="bgBorderRadius">
<option value="0" ${client.style_guide?.layout?.borderRadius === '0' ? 'selected':''}>0px (Sharp)</option>
<option value="4" ${client.style_guide?.layout?.borderRadius === '4' ? 'selected':''}>4px (Subtle)</option>
<option value="8" ${(client.style_guide?.layout?.borderRadius === '8' || !client.style_guide?.layout?.borderRadius) ? 'selected':''}>8px (Rounded)</option>
<option value="12" ${client.style_guide?.layout?.borderRadius === '12' ? 'selected':''}>12px (Smooth)</option>
<option value="20" ${client.style_guide?.layout?.borderRadius === '20' ? 'selected':''}>20px (Pill)</option>
</select>
</div>
<div class="form-group">
<label>Spacing Unit</label>
<select id="bgSpacingUnit">
<option value="4" ${client.style_guide?.layout?.spacingUnit === '4' ? 'selected':''}>Compact (4px base)</option>
<option value="8" ${(client.style_guide?.layout?.spacingUnit === '8' || !client.style_guide?.layout?.spacingUnit) ? 'selected':''}>Standard (8px base)</option>
<option value="12" ${client.style_guide?.layout?.spacingUnit === '12' ? 'selected':''}>Spacious (12px base)</option>
</select>
</div>
<div class="form-group">
<label>Max Width</label>
<select id="bgMaxWidth">
<option value="680" ${client.style_guide?.layout?.maxWidth === '680' ? 'selected':''}>680px (Narrow)</option>
<option value="800" ${(client.style_guide?.layout?.maxWidth === '800' || !client.style_guide?.layout?.maxWidth) ? 'selected':''}>800px (Standard)</option>
<option value="960" ${client.style_guide?.layout?.maxWidth === '960' ? 'selected':''}>960px (Wide)</option>
<option value="1100" ${client.style_guide?.layout?.maxWidth === '1100' ? 'selected':''}>1100px (Full)</option>
</select>
</div>
</div>

<!-- BUTTON STYLES -->
<h3 style="font-size:18px;font-weight:700;margin-bottom:16px;margin-top:24px;">Button Styles</h3>
<div class="two-column" style="margin-bottom:16px;">
<div class="form-group">
<label>Button Shape</label>
<select id="bgButtonShape">
<option value="sharp" ${client.style_guide?.buttons?.shape === 'sharp' ? 'selected':''}>Sharp Corners</option>
<option value="rounded" ${(client.style_guide?.buttons?.shape === 'rounded' || !client.style_guide?.buttons?.shape) ? 'selected':''}>Rounded</option>
<option value="pill" ${client.style_guide?.buttons?.shape === 'pill' ? 'selected':''}>Pill Shape</option>
</select>
</div>
<div class="form-group">
<label>Button Style</label>
<select id="bgButtonStyle">
<option value="solid" ${(client.style_guide?.buttons?.style === 'solid' || !client.style_guide?.buttons?.style) ? 'selected':''}>Solid Fill</option>
<option value="gradient" ${client.style_guide?.buttons?.style === 'gradient' ? 'selected':''}>Gradient</option>
<option value="outline" ${client.style_guide?.buttons?.style === 'outline' ? 'selected':''}>Outline</option>
<option value="shadow" ${client.style_guide?.buttons?.style === 'shadow' ? 'selected':''}>Solid + Shadow</option>
</select>
</div>
</div>
<div id="buttonPreview" style="padding:16px;background:#f8fafc;border-radius:8px;margin-bottom:24px;text-align:center;">
<button style="padding:12px 32px;font-size:15px;font-weight:600;color:#fff;background:${client.style_guide?.colors?.primary || '#2563eb'};border:none;border-radius:8px;cursor:pointer;">Preview CTA Button</button>
</div>

<!-- BRAND VOICE -->
<h3 style="font-size:18px;font-weight:700;margin-bottom:16px;margin-top:24px;">Brand Voice</h3>
<div class="form-group">
<label>Voice Tone</label>
<select id="bgVoiceTone">
<option value="professional" ${(client.style_guide?.voice?.tone === 'professional' || !client.style_guide?.voice?.tone) ? 'selected':''}>Professional & Authoritative</option>
<option value="friendly" ${client.style_guide?.voice?.tone === 'friendly' ? 'selected':''}>Warm & Friendly</option>
<option value="edgy" ${client.style_guide?.voice?.tone === 'edgy' ? 'selected':''}>Bold & Edgy</option>
<option value="luxurious" ${client.style_guide?.voice?.tone === 'luxurious' ? 'selected':''}>Premium & Luxurious</option>
<option value="playful" ${client.style_guide?.voice?.tone === 'playful' ? 'selected':''}>Fun & Playful</option>
<option value="scientific" ${client.style_guide?.voice?.tone === 'scientific' ? 'selected':''}>Scientific & Evidence-Based</option>
</select>
</div>
<div class="form-group">
<label>Brand Keywords (comma-separated)</label>
<input type="text" id="bgBrandKeywords" placeholder="natural, premium, Australian, organic..." value="${client.style_guide?.voice?.keywords || ''}">
</div>

<button class="btn btn-primary" onclick="saveBrandGuide('${client.id}')" style="margin-top:16px;">Save Brand Guide</button>
</div>
</div>
<div id="research-tab" class="tab-content hidden">
<!-- Company Overview -->
<div style="background-color:#ffffff;border:1px solid #e5e7eb;border-radius:12px;padding:24px;margin-bottom:16px;">
<h3 style="font-size:16px;font-weight:700;margin-bottom:16px;">Company Overview</h3>
<div class="two-column">
<div class="form-group">
<label>Company Name</label>
<input type="text" id="resCompanyName" value="${client.name || ''}" onchange="updateResearch('${client.id}')">
</div>
<div class="form-group">
<label>Industry</label>
<input type="text" id="resIndustry" value="${client.industry || ''}" onchange="updateResearch('${client.id}')">
</div>
</div>
<div class="form-group">
<label>Tagline</label>
<input type="text" id="resTagline" value="${client.tagline || ''}" onchange="updateResearch('${client.id}')">
</div>
<div class="form-group">
<label>Value Propositions (one per line)</label>
<textarea id="resValueProps" rows="3" onchange="updateResearch('${client.id}')">${(client.valuePropositions || []).join('\n')}</textarea>
</div>
<div class="form-group">
<label>Brand Voice Description</label>
<textarea id="resBrandVoice" rows="2" placeholder="e.g., We speak like a knowledgeable friend ‚Äî warm, evidence-based, never preachy..." onchange="updateResearch('${client.id}')">${client.brandVoice || ''}</textarea>
</div>
<div class="form-group">
<label>Unique Differentiators (one per line)</label>
<textarea id="resDifferentiators" rows="3" placeholder="What makes this brand fundamentally different from competitors..." onchange="updateResearch('${client.id}')">${(client.differentiators || []).join('\n')}</textarea>
</div>
</div>

<!-- Products / Services -->
<div style="background-color:#ffffff;border:1px solid #e5e7eb;border-radius:12px;padding:24px;margin-bottom:16px;">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
<h3 style="font-size:16px;font-weight:700;">Products / Services</h3>
<button class="btn btn-primary btn-small" onclick="addProduct('${client.id}')">+ Add Product</button>
</div>
<div id="productsList">
${(client.products || []).map((p, i) => `
<div class="product-card" style="padding:16px;border:1px solid #e5e7eb;border-radius:8px;margin-bottom:12px;">
<div style="display:flex;justify-content:space-between;align-items:start;">
<div style="flex:1;">
<div style="font-weight:600;font-size:15px;margin-bottom:4px;">${typeof p === 'string' ? p : p.name || 'Unnamed'}</div>
${typeof p === 'object' ? `
<div style="font-size:13px;color:#6b7280;margin-bottom:6px;">${p.description || ''}</div>
<div style="display:flex;gap:12px;">
${p.price ? `<span style="font-size:13px;font-weight:600;color:#10b981;">$${p.price}</span>` : ''}
${p.features ? `<span style="font-size:12px;color:#64748b;">${(Array.isArray(p.features) ? p.features : []).join(', ')}</span>` : ''}
</div>
` : ''}
</div>
<button onclick="removeProduct('${client.id}', ${i})" style="padding:4px 8px;background:none;border:1px solid #fecaca;border-radius:4px;color:#ef4444;font-size:11px;cursor:pointer;">Remove</button>
</div>
</div>
`).join('')}
${(!client.products || client.products.length === 0) ? '<div style="text-align:center;padding:24px;color:#9ca3af;font-size:13px;">No products added yet</div>' : ''}
</div>
</div>

<!-- Target Audiences -->
<div style="background-color:#ffffff;border:1px solid #e5e7eb;border-radius:12px;padding:24px;">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
<h3 style="font-size:16px;font-weight:700;">Target Audiences</h3>
<button class="btn btn-primary btn-small" onclick="addAudience('${client.id}')">+ Add Audience</button>
</div>
<div id="audiencesList">
${(client.audiences || []).map((a, i) => `
<div style="padding:16px;border:1px solid #e5e7eb;border-radius:8px;margin-bottom:12px;">
<div style="display:flex;justify-content:space-between;align-items:start;">
<div style="flex:1;">
<div style="font-weight:600;font-size:15px;margin-bottom:4px;">${a.name || 'Unnamed Audience'}</div>
<div style="font-size:13px;color:#6b7280;margin-bottom:8px;">${a.description || ''}</div>
${a.painPoints ? `
<div style="font-size:12px;font-weight:600;color:#475569;margin-bottom:4px;">Pain Points:</div>
<div style="display:flex;flex-wrap:wrap;gap:4px;">
${(Array.isArray(a.painPoints) ? a.painPoints : []).map(pp => `<span style="padding:2px 8px;background:#fef2f2;color:#991b1b;border-radius:10px;font-size:11px;">${pp}</span>`).join('')}
</div>
` : ''}
</div>
<button onclick="removeAudience('${client.id}', ${i})" style="padding:4px 8px;background:none;border:1px solid #fecaca;border-radius:4px;color:#ef4444;font-size:11px;cursor:pointer;">Remove</button>
</div>
</div>
`).join('')}
${(!client.audiences || client.audiences.length === 0) ? '<div style="text-align:center;padding:24px;color:#9ca3af;font-size:13px;">No target audiences defined yet</div>' : ''}
</div>
</div>
</div>
<div id="verified-facts-tab" class="tab-content hidden">
<div style="background-color:#ffffff;border:1px solid #e5e7eb;border-radius:12px;padding:24px;">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
<div>
<h3 style="font-size:16px;font-weight:700;margin-bottom:4px;">Verified Claims & Facts</h3>
<p style="font-size:13px;color:#6b7280;">Real, verified data that feeds into your page and ad generation for authentic, trustworthy outputs.</p>
</div>
<div style="display:flex;gap:8px;">
<button class="btn btn-secondary btn-small" onclick="scrapeVerifiedClaims('${client.id}')">Scrape from Website</button>
<button class="btn btn-primary btn-small" onclick="addVerifiedClaim('${client.id}')">+ Add Manually</button>
</div>
</div>
<!-- Filter Tabs -->
<div style="display:flex;gap:8px;margin-bottom:16px;">
<button onclick="filterClaims('all')" class="claim-filter active" style="padding:4px 12px;border-radius:16px;border:1px solid #e2e8f0;background:#f1f5f9;font-size:12px;font-weight:500;cursor:pointer;">All</button>
<button onclick="filterClaims('CLAIM')" class="claim-filter" style="padding:4px 12px;border-radius:16px;border:1px solid #e2e8f0;background:#fff;font-size:12px;font-weight:500;cursor:pointer;">Claims</button>
<button onclick="filterClaims('TESTIMONIAL')" class="claim-filter" style="padding:4px 12px;border-radius:16px;border:1px solid #e2e8f0;background:#fff;font-size:12px;font-weight:500;cursor:pointer;">Testimonials</button>
<button onclick="filterClaims('STATISTIC')" class="claim-filter" style="padding:4px 12px;border-radius:16px;border:1px solid #e2e8f0;background:#fff;font-size:12px;font-weight:500;cursor:pointer;">Statistics</button>
</div>
<div id="claimsList">
${(client.claims || []).map((claim, i) => {
const catColors = { 'CLAIM': { bg: '#eff6ff', color: '#1d4ed8', border: '#bfdbfe' }, 'TESTIMONIAL': { bg: '#f0fdf4', color: '#15803d', border: '#bbf7d0' }, 'STATISTIC': { bg: '#faf5ff', color: '#7c3aed', border: '#ddd6fe' } };
const cc = catColors[claim.category] || catColors['CLAIM'];
return \`
<div class="claim-item" data-category="\${claim.category || 'CLAIM'}" style="padding:16px;border:1px solid \${cc.border};border-radius:8px;margin-bottom:10px;background:\${cc.bg};">
<div style="display:flex;justify-content:space-between;align-items:start;">
<div style="flex:1;">
<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
<span style="padding:2px 8px;background:\${cc.color};color:#fff;border-radius:10px;font-size:10px;font-weight:700;text-transform:uppercase;">\${claim.category || 'CLAIM'}</span>
</div>
<div style="font-weight:500;font-size:14px;line-height:1.5;color:#1e293b;">\${claim.text || claim.claim || ''}</div>
\${claim.source ? \`<div style="font-size:12px;color:#64748b;margin-top:6px;">Source: <a href="\${claim.source}" target="_blank" style="color:\${cc.color};text-decoration:underline;">\${claim.source}</a></div>\` : ''}
</div>
<button onclick="removeClaim('\${client.id}', \${i})" style="padding:4px 8px;background:none;border:1px solid #fecaca;border-radius:4px;color:#ef4444;font-size:11px;cursor:pointer;flex-shrink:0;margin-left:12px;">Remove</button>
</div>
</div>
\`;
}).join('')}
${(!client.claims || client.claims.length === 0) ? '<div style="text-align:center;padding:32px;color:#9ca3af;font-size:13px;">No verified claims yet. Click "Scrape from Website" to auto-extract claims, or add them manually.</div>' : ''}
</div>
</div>
</div>
<div id="assets-tab" class="tab-content hidden">
<div style="background-color:#ffffff;border:1px solid #e5e7eb;border-radius:12px;padding:24px;">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
<div>
<h3 style="font-size:16px;font-weight:700;margin-bottom:4px;">Scraped Website Images</h3>
<p style="font-size:13px;color:#6b7280;">Product images and assets automatically pulled from the client's website. These are injected into generated pages.</p>
</div>
<button class="btn btn-secondary btn-small" onclick="rescrapeImages('${client.id}', '${client.website || ''}')">Re-scrape Images</button>
</div>
<div id="scrapedImageGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;">
${(client._scrapedImages || client.scrapedImages || []).map((img, i) => `
<div style="border:1px solid #e5e7eb;border-radius:8px;overflow:hidden;position:relative;cursor:pointer;" title="${img.alt || img.url}" onclick="selectAssetImage(this)">
<img src="${img.url}" alt="${img.alt || 'Product image'}" style="width:100%;aspect-ratio:1;object-fit:cover;display:block;" loading="lazy" onerror="this.parentElement.style.display='none'">
<div style="padding:6px 8px;font-size:11px;">
<span style="padding:1px 6px;background:${img.category === 'product' ? '#dbeafe' : img.category === 'hero' ? '#fef3c7' : '#f1f5f9'};color:${img.category === 'product' ? '#1d4ed8' : img.category === 'hero' ? '#92400e' : '#475569'};border-radius:6px;font-weight:600;text-transform:uppercase;font-size:9px;">${img.category || 'general'}</span>
</div>
</div>
`).join('')}
${(!client._scrapedImages && !client.scrapedImages) || (client._scrapedImages || client.scrapedImages || []).length === 0 ? '<div style="text-align:center;padding:32px;color:#9ca3af;font-size:13px;grid-column:1/-1;">No images scraped yet. Run the pipeline or click "Re-scrape Images" to pull images from the client website.</div>' : ''}
</div>
</div>
</div>
<div id="pages-tab" class="tab-content hidden">
<div class="table-container">
<table>
<thead>
<tr>
<th>Page Name</th>
<th>Status</th>
<th>Views</th>
<th>Leads</th>
</tr>
</thead>
<tbody id="clientPagesTable">
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
`;
container.innerHTML = html;
renderClientPages(client.id);
}
function switchClientTab(element, tabName){
document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
element.classList.add('active');
document.getElementById(tabName + '-tab').classList.remove('hidden');
}
function renderClientPages(clientId){
const tbody = document.getElementById('clientPagesTable');
const clientPages = app.pages.filter(p => p.clientId === clientId);
tbody.innerHTML = '';
if (clientPages.length === 0){
tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:32px;color:#6b7280;">No pages for this client yet</td></tr>';
return;
}
clientPages.forEach(page =>{
const row = document.createElement('tr');
row.innerHTML = `
<td><strong>${page.name}</strong></td>
<td><span class="badge ${page.status === 'live' ? 'badge-success':'badge-gray'}">${page.status === 'live' ? 'Live':'Draft'}</span></td>
<td>${page.views || 0}</td>
<td>${page.leads || 0}</td>
`;
tbody.appendChild(row);
});
}
function renderAddClientForm(container){
const html = `
<div style="max-width:600px;">
<div class="form-group">
<label>Client Name *</label>
<input type="text" id="clientName" placeholder="Your Client Name">
</div>
<div class="form-group">
<label>Website</label>
<input type="url" id="clientWebsite" placeholder="https://example.com">
</div>
<div class="form-group">
<label>Industry</label>
<input type="text" id="clientIndustry" placeholder="e.g., Technology, Health, Finance">
</div>
<div class="form-group">
<label>Tagline</label>
<input type="text" id="clientTagline" placeholder="Company tagline">
</div>
<div class="form-group">
<label>Value Propositions</label>
<textarea id="clientValueProps" placeholder="One per line"></textarea>
</div>
<div style="display:flex;gap:12px;">
<button class="btn btn-primary" onclick="addClient()">Create Client</button>
<button class="btn btn-secondary" onclick="showView('all-clients')">Cancel</button>
</div>
</div>
`;
container.innerHTML = html;
}
function addClient(){
const clientData ={
name:document.getElementById('clientName').value,
website:document.getElementById('clientWebsite').value,
industry:document.getElementById('clientIndustry').value,
tagline:document.getElementById('clientTagline').value,
valuePropositions:document.getElementById('clientValueProps').value.split('\n').filter(v => v.trim())
};
if (!clientData.name){
alert('Client name is required');
return;
}
fetch('/api/clients',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify(clientData)
})
.then(res => res.json())
.then(data =>{
loadClients();
loadClientsForSelects();
showView('all-clients');
alert('Client created successfully!');
})
.catch(err =>{
console.error('Failed to create client:', err);
alert('Failed to create client');
});
}
function renderAdGenerator(container){
const html = `
<div id="adGeneratorSteps">
<div class="steps">
<div class="step active" id="step1">
<div class="step-number">1</div>
<div class="step-label">Client</div>
</div>
<div class="step" id="step2">
<div class="step-number">2</div>
<div class="step-label">Mode</div>
</div>
<div class="step" id="step3">
<div class="step-number">3</div>
<div class="step-label">Settings</div>
</div>
<div class="step" id="step4">
<div class="step-number">4</div>
<div class="step-label">Results</div>
</div>
</div>
<div id="adStep1" class="ad-step">
<h2 style="margin-bottom:24px;font-size:20px;font-weight:700;">Select Client</h2>
<div class="cards-grid" style="grid-template-columns:repeat(auto-fill, minmax(150px, 1fr));">
${app.clients.map(client => `
<div class="card-option" onclick="selectAdClient(this, '${client.id}')">
<div style="font-size:28px;margin-bottom:12px;">üè¢</div>
<div class="card-option-title">${client.name}</div>
</div>
`).join('')}
</div>
<div style="margin-top:32px;">
<button class="btn btn-primary" onclick="moveAdStep(2)" id="adClientNextBtn" disabled>Continue ‚Üí</button>
</div>
</div>
<div id="adStep2" class="ad-step hidden">
<h2 style="margin-bottom:24px;font-size:20px;font-weight:700;">Choose Generation Mode</h2>
<div class="cards-grid" style="grid-template-columns:repeat(auto-fill, minmax(180px, 1fr));">
<div class="card-option" onclick="selectAdMode(this, 'copy')">
<div style="font-size:32px;margin-bottom:12px;">‚úçÔ∏è</div>
<div class="card-option-title">Ad Copy</div>
<div class="card-option-desc">Generate ad headlines</div>
</div>
<div class="card-option" onclick="selectAdMode(this, 'images')">
<div style="font-size:32px;margin-bottom:12px;">üñºÔ∏è</div>
<div class="card-option-title">Image Prompts</div>
<div class="card-option-desc">Generate image ideas</div>
</div>
<div class="card-option" onclick="selectAdMode(this, 'email-sequence')">
<div style="font-size:32px;margin-bottom:12px;">üìß</div>
<div class="card-option-title">Email Sequence</div>
<div class="card-option-desc">Nurture email series</div>
</div>
<div class="card-option" onclick="selectAdMode(this, 'full')">
<div style="font-size:32px;margin-bottom:12px;">üìä</div>
<div class="card-option-title">Full Package</div>
<div class="card-option-desc">Copy + images + emails</div>
</div>
</div>
<div style="margin-top:32px;display:flex;gap:12px;">
<button class="btn btn-secondary" onclick="moveAdStep(1)">‚Üê Back</button>
<button class="btn btn-primary" onclick="moveAdStep(3)" id="adModeNextBtn" disabled>Continue ‚Üí</button>
</div>
</div>
<div id="adStep3" class="ad-step hidden">
<h2 style="margin-bottom:24px;font-size:20px;font-weight:700;">Configure Settings</h2>
<!-- Ad Copy Settings -->
<div id="adCopySettings">
<h3 style="font-size:15px;font-weight:600;margin-bottom:16px;color:#475569;">Ad Copy Settings</h3>
<div class="two-column">
<div class="form-group">
<label>Ad Type</label>
<select id="adType">
<option value="single">Single Image Ad</option>
<option value="carousel">Carousel Ad</option>
<option value="video">Video Ad</option>
<option value="story">Story Ad</option>
</select>
</div>
<div class="form-group">
<label>Tone</label>
<select id="adTone">
<option value="conversational">Conversational</option>
<option value="professional">Professional</option>
<option value="urgent">Urgent</option>
<option value="playful">Playful</option>
<option value="authoritative">Authoritative</option>
</select>
</div>
</div>
<div class="form-group">
<label>Hook Framework</label>
<select id="adHook">
<option value="">Auto-select best...</option>
<option value="problem-agitate-solution">Problem-Agitate-Solution</option>
<option value="curiosity-gap">Curiosity Gap</option>
<option value="contrarian">Contrarian</option>
<option value="social-proof">Social Proof</option>
<option value="direct-benefit">Direct Benefit</option>
<option value="story-hook">Story Hook</option>
<option value="question-hook">Question Hook</option>
<option value="statistic-lead">Statistic Lead</option>
<option value="before-after">Before/After</option>
<option value="fomo">FOMO</option>
</select>
</div>
<div class="form-group">
<label>Target Audience (Optional)</label>
<textarea id="adAudience" placeholder="Describe your ideal customer..."></textarea>
</div>
<div class="form-group">
<label>Offer Details (Optional)</label>
<input id="adOffer" placeholder="e.g., 20% off, Free shipping, etc." />
</div>
<div class="form-group">
<label>Number of Variations</label>
<select id="adVariations">
<option value="3">3 variations</option>
<option value="5" selected>5 variations</option>
<option value="10">10 variations</option>
</select>
</div>
</div>
<!-- Image Prompt Settings -->
<div id="adImageSettings">
<h3 style="font-size:15px;font-weight:600;margin:24px 0 16px;color:#475569;border-top:1px solid #e2e8f0;padding-top:24px;">Image Prompt Settings</h3>
<div class="form-group">
<label>Awareness Level</label>
<select id="adAwareness">
<option value="problem_aware">Problem Aware - Pain visualization</option>
<option value="unaware">Unaware - Pattern interrupt, curiosity</option>
<option value="solution_aware">Solution Aware - Differentiation</option>
<option value="product_aware">Product Aware - Social proof</option>
<option value="most_aware">Most Aware - Urgency, offer</option>
</select>
</div>
<div class="form-group">
<label>Cognitive Biases (Select 1-5)</label>
<div id="biasGrid" style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-bottom:8px;">
</div>
<div style="margin-top:8px;font-size:12px;color:#64748b;">Or use a Power Stack:</div>
<div id="powerStacks" style="display:flex;gap:6px;margin-top:6px;flex-wrap:wrap;">
<button type="button" onclick="applyPowerStack('urgency')" class="power-stack-btn" style="padding:4px 12px;border:1px solid #e2e8f0;border-radius:16px;background:#fff;font-size:12px;font-weight:500;cursor:pointer;">Urgency</button>
<button type="button" onclick="applyPowerStack('trust')" class="power-stack-btn" style="padding:4px 12px;border:1px solid #e2e8f0;border-radius:16px;background:#fff;font-size:12px;font-weight:500;cursor:pointer;">Trust</button>
<button type="button" onclick="applyPowerStack('desire')" class="power-stack-btn" style="padding:4px 12px;border:1px solid #e2e8f0;border-radius:16px;background:#fff;font-size:12px;font-weight:500;cursor:pointer;">Desire</button>
<button type="button" onclick="applyPowerStack('comparison')" class="power-stack-btn" style="padding:4px 12px;border:1px solid #e2e8f0;border-radius:16px;background:#fff;font-size:12px;font-weight:500;cursor:pointer;">Comparison</button>
<button type="button" onclick="applyPowerStack('identity')" class="power-stack-btn" style="padding:4px 12px;border:1px solid #e2e8f0;border-radius:16px;background:#fff;font-size:12px;font-weight:500;cursor:pointer;">Identity</button>
</div>
</div>
<div class="form-group">
<label>Ad Styles (Select 1-5)</label>
<div id="styleGrid" style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-bottom:8px;">
</div>
</div>
<div class="two-column">
<div class="form-group">
<label>Aspect Ratio</label>
<select id="adAspectRatio">
<option value="4:5">4:5 Vertical (Best for Feed)</option>
<option value="1:1">1:1 Square</option>
<option value="9:16">9:16 Stories/Reels</option>
<option value="16:9">16:9 Landscape</option>
<option value="1.91:1">1.91:1 Link Preview</option>
</select>
</div>
<div class="form-group">
<label>Number of Prompts</label>
<select id="adNumPrompts">
<option value="3">3 prompts</option>
<option value="5" selected>5 prompts</option>
<option value="10">10 prompts</option>
</select>
</div>
</div>
<div class="form-group">
<label>Custom Concept (Optional)</label>
<textarea id="adCustomConcept" placeholder="Describe a specific ad image you want..."></textarea>
</div>
</div>
<!-- Common platform -->
<div class="form-group" style="margin-top:24px;border-top:1px solid #e2e8f0;padding-top:16px;">
<label>Platform</label>
<select id="adPlatform">
<option value="facebook">Facebook</option>
<option value="instagram">Instagram</option>
<option value="linkedin">LinkedIn</option>
<option value="tiktok">TikTok</option>
<option value="google">Google Ads</option>
</select>
</div>
<!-- Email sequence settings -->
<div id="adEmailSettings" style="display:none;">
<div class="two-column">
<div class="form-group">
<label>Sequence Type</label>
<select id="emailSeqType">
<option value="lead-nurture">Lead Nurture</option>
<option value="sales-funnel">Sales Funnel</option>
<option value="educational">Educational</option>
<option value="launch">Product Launch</option>
<option value="abandoned-cart">Abandoned Cart</option>
</select>
</div>
<div class="form-group">
<label>Number of Emails</label>
<select id="emailSeqLength">
<option value="3">3 emails</option>
<option value="5" selected>5 emails</option>
<option value="7">7 emails</option>
<option value="10">10 emails</option>
</select>
</div>
</div>
<div class="form-group">
<label>Days Between Emails</label>
<select id="emailDaysBetween">
<option value="1">Every day</option>
<option value="2" selected>Every 2 days</option>
<option value="3">Every 3 days</option>
</select>
</div>
</div>
<div class="mt-4;display:flex;gap:12px;">
<button class="btn btn-secondary" onclick="moveAdStep(2)">‚Üê Back</button>
<button class="btn btn-primary" onclick="moveAdStep(4)">Generate Ads ‚Üí</button>
</div>
</div>
<div id="adStep4" class="ad-step hidden">
<h2 style="margin-bottom:24px;font-size:20px;font-weight:700;">Generated Ads</h2>
<div id="adResults" style="display:flex;flex-direction:column;gap:16px;">
<div style="background-color:#f9fafb;border:1px dashed #e5e7eb;border-radius:8px;padding:32px;text-align:center;color:#6b7280;">
Click Generate to see results
</div>
</div>
<div style="margin-top:32px;display:flex;gap:12px;">
<button class="btn btn-secondary" onclick="moveAdStep(3)">‚Üê Back</button>
<button class="btn btn-primary" onclick="generateAds()">Generate Ads</button>
</div>
</div>
</div>
`;
container.innerHTML = html;
}
function selectAdClient(element, clientId){
document.querySelectorAll('#adStep1 .card-option').forEach(el => el.classList.remove('selected'));
element.classList.add('selected');
document.getElementById('adClientNextBtn').disabled = false;
app.currentClient = clientId;
}
function selectAdMode(element, mode){
document.querySelectorAll('#adStep2 .card-option').forEach(el => el.classList.remove('selected'));
element.classList.add('selected');
document.getElementById('adModeNextBtn').disabled = false;
app.selectedAdMode = mode;
// Show/hide mode-specific settings
const copySettings = document.getElementById('adCopySettings');
const emailSettings = document.getElementById('adEmailSettings');
if (copySettings) copySettings.style.display = (mode === 'copy' || mode === 'images' || mode === 'full') ? 'block' : 'none';
if (emailSettings) emailSettings.style.display = (mode === 'email-sequence' || mode === 'full') ? 'block' : 'none';
}
function moveAdStep(stepNumber){
for (let i = 1;i <= 4;i++){
const step = document.getElementById(`adStep${i}`);
const stepIndicator = document.getElementById(`step${i}`);
if (step){
if (i === stepNumber){
step.classList.remove('hidden');
stepIndicator.classList.add('active');
if (i > 1){
for (let j = 1;j < i;j++){
document.getElementById(`step${j}`).classList.add('completed');
}
}
}else{
step.classList.add('hidden');
stepIndicator.classList.remove('active');
}
}
}
// Populate grids when entering step 3
if (stepNumber === 3) populateAdSettingsGrids();
}

// ============================================================
// COGNITIVE BIAS & AD STYLE SELECTION GRIDS
// ============================================================
const BIAS_DATA = {
  'loss_aversion': { label: 'Loss Aversion', icon: 'üò∞', tip: 'Losses feel 2x stronger than gains' },
  'sunk_cost': { label: 'Sunk Cost', icon: 'üí∞', tip: 'Invested too much to quit now' },
  'zero_risk': { label: 'Zero Risk', icon: 'üõ°Ô∏è', tip: 'Eliminate all perceived risk' },
  'regret_aversion': { label: 'Regret Aversion', icon: 'üò´', tip: 'Fear of future regret drives action' },
  'endowment': { label: 'Endowment', icon: 'üéÅ', tip: 'Feel ownership before buying' },
  'social_proof': { label: 'Social Proof', icon: 'üë•', tip: 'Others doing it = must be good' },
  'bandwagon': { label: 'Bandwagon', icon: 'üöÇ', tip: 'Everyone\'s joining, don\'t miss out' },
  'in_group': { label: 'In-Group', icon: 'ü§ù', tip: 'Us vs them, belong to the smart group' },
  'authority': { label: 'Authority', icon: 'üî¨', tip: 'Expert endorsements & data' },
  'halo_effect': { label: 'Halo Effect', icon: '‚ú®', tip: 'Associate with admired brands' },
  'liking': { label: 'Liking', icon: 'üòä', tip: 'We buy from people we like' },
  'anchoring': { label: 'Anchoring', icon: '‚öì', tip: 'High reference price ‚Üí deal feels amazing' },
  'framing': { label: 'Framing', icon: 'üñºÔ∏è', tip: '95% success vs 5% failure' },
  'availability_heuristic': { label: 'Availability', icon: 'üí≠', tip: 'Vivid examples come to mind first' },
  'representativeness': { label: 'Representativeness', icon: 'üéØ', tip: 'Ideal customer looks just like them' },
  'default_effect': { label: 'Default Effect', icon: '‚úÖ', tip: 'Pre-select the best option' },
  'mere_exposure': { label: 'Mere Exposure', icon: 'üîÑ', tip: 'Familiarity breeds preference' },
  'scarcity': { label: 'Scarcity', icon: '‚è∞', tip: 'Limited time/quantity = urgency' },
  'curiosity_gap': { label: 'Curiosity Gap', icon: 'üîç', tip: 'Tease without revealing' },
  'ikea_effect': { label: 'IKEA Effect', icon: 'üîß', tip: 'People value what they build' },
  'reciprocity': { label: 'Reciprocity', icon: 'üéÅ', tip: 'Give free value, then ask' },
  'commitment_consistency': { label: 'Commitment', icon: 'üìù', tip: 'Small yes leads to big yes' },
  'goal_gradient': { label: 'Goal Gradient', icon: 'üìä', tip: 'Almost there = push harder' },
  'contrast_effect': { label: 'Contrast', icon: '‚öñÔ∏è', tip: 'Bad alternative makes yours shine' },
  'decoy_effect': { label: 'Decoy Effect', icon: 'üéØ', tip: 'Third option makes target best' },
  'von_restorff': { label: 'Isolation', icon: 'üíé', tip: 'Stand out = get remembered' },
  'picture_superiority': { label: 'Picture Power', icon: 'üì∏', tip: 'Images remembered 6x better' },
  'rhyme_as_reason': { label: 'Rhyme/Reason', icon: 'üéµ', tip: 'Rhymes feel more true' },
  'processing_fluency': { label: 'Fluency', icon: 'üßä', tip: 'Simple = trustworthy' },
  'ben_franklin': { label: 'Ben Franklin', icon: 'ü§î', tip: 'Do a favor ‚Üí start liking them' },
  'pratfall_effect': { label: 'Pratfall', icon: 'üòÖ', tip: 'Small flaw = more relatable' },
  'peak_end_rule': { label: 'Peak-End', icon: 'üèîÔ∏è', tip: 'Best moment + ending = memory' },
  'confirmation_bias': { label: 'Confirmation', icon: 'üß†', tip: 'Affirm what they believe' },
  'survivorship_bias': { label: 'Survivorship', icon: 'üèÜ', tip: 'Spotlight success stories' }
};

const STYLE_DATA = {
  'professional_studio': { label: 'Studio', icon: 'üì∑' },
  'lifestyle': { label: 'Lifestyle', icon: 'üåø' },
  'ugc_raw': { label: 'UGC Raw', icon: 'üì±' },
  'flatlay': { label: 'Flat Lay', icon: 'üî≤' },
  'minimalist': { label: 'Minimal', icon: '‚¨ú' },
  'maximalist': { label: 'Maximalist', icon: 'üé®' },
  'dark_mode': { label: 'Dark Mode', icon: 'üåë' },
  'editorial': { label: 'Editorial', icon: 'üì∞' },
  '3d_render': { label: '3D Render', icon: 'üßä' },
  'hand_drawn': { label: 'Hand Drawn', icon: '‚úèÔ∏è' },
  'product_demo': { label: 'Demo', icon: '‚ñ∂Ô∏è' },
  'founder_forward': { label: 'Founder', icon: 'üë§' },
  'ingredient_breakdown': { label: 'Ingredients', icon: 'üî¨' },
  'behind_scenes': { label: 'BTS', icon: 'üé¨' },
  'packaging_hero': { label: 'Packaging', icon: 'üì¶' },
  'unboxing': { label: 'Unboxing', icon: 'üéÅ' },
  'text_typography': { label: 'Typography', icon: 'üî§' },
  'screenshot': { label: 'Screenshot', icon: 'üñ•Ô∏è' },
  'meme_native': { label: 'Meme', icon: 'üòÇ' },
  'split_screen': { label: 'Split Screen', icon: '‚¨õ‚¨ú' },
  'before_after': { label: 'Before/After', icon: 'üîÑ' },
  'social_proof_stack': { label: 'Proof Stack', icon: '‚≠ê' },
  'problem_visualization': { label: 'Problem Viz', icon: 'üî¥' },
  'curiosity_gap': { label: 'Curiosity', icon: '‚ùì' },
  'urgency_scarcity': { label: 'Urgency', icon: 'üö®' },
  'lego_brick': { label: 'LEGO', icon: 'üß±' },
  'claymation': { label: 'Claymation', icon: 'üè∫' },
  'wobble_jelly': { label: 'Jelly', icon: 'üçÆ' },
  'crayon_drawing': { label: 'Crayon', icon: 'üñçÔ∏è' },
  'whiteboard': { label: 'Whiteboard', icon: 'üìã' },
  'paper_cutout': { label: 'Cutout', icon: '‚úÇÔ∏è' },
  'pixel_art': { label: 'Pixel Art', icon: 'üëæ' },
  'watercolor': { label: 'Watercolor', icon: 'üé®' },
  'chalkboard': { label: 'Chalkboard', icon: 'üìì' },
  'pop_art': { label: 'Pop Art', icon: 'üé≠' },
  'neon_cyberpunk': { label: 'Neon', icon: 'üíú' },
  'vintage_poster': { label: 'Vintage', icon: 'üìú' },
  'blueprint': { label: 'Blueprint', icon: 'üìê' },
  'embroidery': { label: 'Embroidery', icon: 'üßµ' },
  'balloon_inflatable': { label: 'Balloon', icon: 'üéà' },
  'ice_sculpture': { label: 'Ice', icon: 'üßä' },
  'food_art': { label: 'Food Art', icon: 'üçΩÔ∏è' },
  'miniature_tilt': { label: 'Miniature', icon: 'üè†' },
  'xray_see_through': { label: 'X-Ray', icon: 'ü©ª' },
  'holographic': { label: 'Holographic', icon: 'üåà' },
  'origami': { label: 'Origami', icon: 'ü¶¢' },
  'stained_glass': { label: 'Stained Glass', icon: 'üèõÔ∏è' },
  'mosaic': { label: 'Mosaic', icon: 'üß©' },
  'sand_sculpture': { label: 'Sand', icon: 'üèñÔ∏è' },
  'cloud_smoke': { label: 'Cloud', icon: '‚òÅÔ∏è' }
};

app.selectedBiases = [];
app.selectedStyles = [];

function populateAdSettingsGrids() {
  const biasGrid = document.getElementById('biasGrid');
  const styleGrid = document.getElementById('styleGrid');
  if (!biasGrid || !styleGrid) return;

  // Only populate if empty
  if (biasGrid.children.length === 0) {
    biasGrid.innerHTML = Object.entries(BIAS_DATA).map(([key, val]) => `
      <div class="bias-tile" data-bias="${key}" onclick="toggleBias(this, '${key}')" title="${val.tip}"
        style="padding:6px 4px;border:1px solid #e2e8f0;border-radius:8px;text-align:center;cursor:pointer;transition:all 0.15s;font-size:11px;background:#fff;user-select:none;">
        <div style="font-size:16px;margin-bottom:2px;">${val.icon}</div>
        <div style="font-weight:500;line-height:1.2;color:#475569;">${val.label}</div>
      </div>
    `).join('');
  }

  if (styleGrid.children.length === 0) {
    styleGrid.innerHTML = Object.entries(STYLE_DATA).map(([key, val]) => `
      <div class="style-tile" data-style="${key}" onclick="toggleStyle(this, '${key}')"
        style="padding:6px 4px;border:1px solid #e2e8f0;border-radius:8px;text-align:center;cursor:pointer;transition:all 0.15s;font-size:11px;background:#fff;user-select:none;">
        <div style="font-size:16px;margin-bottom:2px;">${val.icon}</div>
        <div style="font-weight:500;line-height:1.2;color:#475569;">${val.label}</div>
      </div>
    `).join('');
  }
}

function toggleBias(el, biasKey) {
  const idx = app.selectedBiases.indexOf(biasKey);
  if (idx >= 0) {
    app.selectedBiases.splice(idx, 1);
    el.style.background = '#fff';
    el.style.borderColor = '#e2e8f0';
    el.style.boxShadow = 'none';
  } else {
    if (app.selectedBiases.length >= 5) {
      // Deselect the oldest
      const oldKey = app.selectedBiases.shift();
      const oldEl = document.querySelector(`.bias-tile[data-bias="${oldKey}"]`);
      if (oldEl) { oldEl.style.background = '#fff'; oldEl.style.borderColor = '#e2e8f0'; oldEl.style.boxShadow = 'none'; }
    }
    app.selectedBiases.push(biasKey);
    el.style.background = 'linear-gradient(135deg,#ede9fe,#ddd6fe)';
    el.style.borderColor = '#8b5cf6';
    el.style.boxShadow = '0 0 0 1px #8b5cf6';
  }
  // Clear power stack highlights
  document.querySelectorAll('.power-stack-btn').forEach(b => { b.style.background = '#fff'; b.style.color = '#334155'; });
}

function toggleStyle(el, styleKey) {
  const idx = app.selectedStyles.indexOf(styleKey);
  if (idx >= 0) {
    app.selectedStyles.splice(idx, 1);
    el.style.background = '#fff';
    el.style.borderColor = '#e2e8f0';
    el.style.boxShadow = 'none';
  } else {
    if (app.selectedStyles.length >= 5) {
      const oldKey = app.selectedStyles.shift();
      const oldEl = document.querySelector(`.style-tile[data-style="${oldKey}"]`);
      if (oldEl) { oldEl.style.background = '#fff'; oldEl.style.borderColor = '#e2e8f0'; oldEl.style.boxShadow = 'none'; }
    }
    app.selectedStyles.push(styleKey);
    el.style.background = 'linear-gradient(135deg,#e0f2fe,#bae6fd)';
    el.style.borderColor = '#0ea5e9';
    el.style.boxShadow = '0 0 0 1px #0ea5e9';
  }
}

function applyPowerStack(stackName) {
  const stacks = {
    'urgency': ['scarcity', 'loss_aversion', 'regret_aversion', 'goal_gradient', 'zero_risk'],
    'trust': ['social_proof', 'authority', 'commitment_consistency', 'processing_fluency', 'pratfall_effect'],
    'desire': ['endowment', 'curiosity_gap', 'mere_exposure', 'peak_end_rule', 'picture_superiority'],
    'comparison': ['anchoring', 'contrast_effect', 'decoy_effect', 'framing', 'zero_risk'],
    'identity': ['in_group', 'confirmation_bias', 'liking', 'bandwagon', 'representativeness']
  };
  const biases = stacks[stackName] || [];
  // Clear all current selections
  app.selectedBiases = [];
  document.querySelectorAll('.bias-tile').forEach(el => { el.style.background = '#fff'; el.style.borderColor = '#e2e8f0'; el.style.boxShadow = 'none'; });
  // Select the stack biases
  biases.forEach(b => {
    const el = document.querySelector(`.bias-tile[data-bias="${b}"]`);
    if (el) {
      app.selectedBiases.push(b);
      el.style.background = 'linear-gradient(135deg,#ede9fe,#ddd6fe)';
      el.style.borderColor = '#8b5cf6';
      el.style.boxShadow = '0 0 0 1px #8b5cf6';
    }
  });
  // Highlight active power stack button
  document.querySelectorAll('.power-stack-btn').forEach(btn => {
    if (btn.textContent.trim().toLowerCase() === stackName) {
      btn.style.background = 'linear-gradient(135deg,#8b5cf6,#6d28d9)';
      btn.style.color = '#fff';
    } else {
      btn.style.background = '#fff';
      btn.style.color = '#334155';
    }
  });
}
// ============================================================
// NANO BANANA PRO - AI IMAGE GENERATION
// ============================================================
async function generateNanoBananaImage(promptId, btn) {
  const promptText = document.getElementById(promptId + '-text')?.textContent || '';
  const resultDiv = document.getElementById(promptId + '-result');
  if (!promptText || !resultDiv) return;

  // Update button state
  const originalHTML = btn.innerHTML;
  btn.disabled = true;
  btn.style.opacity = '0.7';
  btn.innerHTML = `<div class="loading" style="width:14px;height:14px;border-width:2px;margin:0;"></div> Generating...`;

  // Show loading in result area
  resultDiv.style.display = 'block';
  resultDiv.innerHTML = `
    <div style="text-align:center;padding:40px 20px;background:#faf5ff;border-radius:8px;border:1px dashed #c4b5fd;">
      <div class="loading" style="margin:0 auto 12px;"></div>
      <div style="font-size:13px;color:#7c3aed;font-weight:500;">Generating with Nano Banana Pro...</div>
      <div style="font-size:11px;color:#9ca3af;margin-top:4px;">This may take 10-30 seconds</div>
    </div>`;

  try {
    const response = await fetch('/api/generate-image', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        prompt: promptText,
        aspect_ratio: document.getElementById('adAspectRatio')?.value || '4:5'
      })
    });

    const data = await response.json();

    if (data.success && data.image) {
      const imgSrc = `data:${data.image.mimeType};base64,${data.image.data}`;
      resultDiv.innerHTML = `
        <div style="position:relative;border-radius:8px;overflow:hidden;border:1px solid #e5e7eb;">
          <img src="${imgSrc}" style="width:100%;display:block;border-radius:8px;" alt="Generated ad image" />
          <div style="position:absolute;top:8px;right:8px;display:flex;gap:6px;">
            <button onclick="downloadGeneratedImage(this.closest('div').previousElementSibling || this.closest('div').querySelector('img'), '${promptId}')" style="padding:6px 12px;background:rgba(0,0,0,0.7);color:#fff;border:none;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;backdrop-filter:blur(4px);">
              Download
            </button>
            <button onclick="generateNanoBananaImage('${promptId}', document.querySelector('[onclick*=\\'${promptId}\\']'))" style="padding:6px 12px;background:rgba(124,58,237,0.9);color:#fff;border:none;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;backdrop-filter:blur(4px);">
              Regenerate
            </button>
          </div>
        </div>
        <div style="margin-top:6px;display:flex;justify-content:space-between;align-items:center;">
          <span style="font-size:11px;color:#9ca3af;">Generated by Nano Banana Pro (Gemini)</span>
        </div>`;

      // Reset button to show "Regenerate" state
      btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg> Regenerate`;
      btn.style.background = 'linear-gradient(135deg,#6d28d9,#4c1d95)';
    } else {
      resultDiv.innerHTML = `
        <div style="padding:16px;background:#fef2f2;border-radius:8px;border:1px solid #fecaca;">
          <div style="font-size:13px;color:#dc2626;font-weight:600;margin-bottom:4px;">Image generation failed</div>
          <div style="font-size:12px;color:#991b1b;">${data.error || data.message || 'Unknown error'}</div>
        </div>`;
      btn.innerHTML = originalHTML;
    }
  } catch (err) {
    resultDiv.innerHTML = `
      <div style="padding:16px;background:#fef2f2;border-radius:8px;border:1px solid #fecaca;">
        <div style="font-size:13px;color:#dc2626;font-weight:600;margin-bottom:4px;">Connection error</div>
        <div style="font-size:12px;color:#991b1b;">${err.message}</div>
      </div>`;
    btn.innerHTML = originalHTML;
  }

  btn.disabled = false;
  btn.style.opacity = '1';
}

function downloadGeneratedImage(imgEl, name) {
  // Find the img element
  const img = imgEl.tagName === 'IMG' ? imgEl : imgEl.parentElement.querySelector('img');
  if (!img) return;
  const a = document.createElement('a');
  a.href = img.src;
  a.download = `runads-${name || 'image'}-${Date.now()}.png`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}

function generateAds(){
const resultDiv = document.getElementById('adResults');
resultDiv.innerHTML = '<div class="loading" style="margin:32px auto;"></div><div style="text-align:center;color:#6b7280;margin-top:12px;">Generating with psychological triggers...</div>';
const mode = app.selectedAdMode === 'campaign' ? 'full' : app.selectedAdMode;
const payload = {
  mode: mode,
  client_data: app.clients.find(c => c.id === app.currentClient) || {},
  platform: document.getElementById('adPlatform')?.value || 'facebook',
  awareness_level: document.getElementById('adAwareness')?.value || 'problem_aware',
  target_audience: document.getElementById('adAudience')?.value,
  offer_details: document.getElementById('adOffer')?.value,
  ad_type: document.getElementById('adType')?.value,
  tone: document.getElementById('adTone')?.value,
  hook_framework: document.getElementById('adHook')?.value,
  num_variations: parseInt(document.getElementById('adVariations')?.value || '3'),
  // Image prompt settings
  cognitive_biases: app.selectedBiases || [],
  ad_styles: app.selectedStyles || [],
  aspect_ratio: document.getElementById('adAspectRatio')?.value || '4:5',
  num_prompts: parseInt(document.getElementById('adNumPrompts')?.value || '5'),
  custom_concept: document.getElementById('adCustomConcept')?.value || '',
  // Email sequence settings
  sequence_type: document.getElementById('emailSeqType')?.value,
  sequence_length: parseInt(document.getElementById('emailSeqLength')?.value || '5'),
  days_between: parseInt(document.getElementById('emailDaysBetween')?.value || '2')
};
fetch('/api/ads',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify(payload)
})
.then(res => res.json())
.then(data =>{
resultDiv.innerHTML = '';
// Show triggers used
if (data.triggers_used && data.triggers_used.length > 0) {
  const triggerBadges = data.triggers_used.map(t =>
    `<span style="display:inline-block;padding:4px 10px;background:#f3e8ff;color:#7c3aed;border-radius:12px;font-size:12px;font-weight:600;margin:2px;">${t.name}</span>`
  ).join('');
  resultDiv.innerHTML += `<div style="margin-bottom:16px;"><span style="font-size:13px;color:#6b7280;margin-right:8px;">Triggers Applied:</span>${triggerBadges}</div>`;
}
// Show platform info
if (data.platform_optimization) {
  resultDiv.innerHTML += `<div style="margin-bottom:16px;padding:8px 12px;background:#f0f9ff;border-radius:6px;font-size:12px;color:#0369a1;">Platform: ${data.platform_optimization.platform} | Cost: $${data.estimated_cost || '0.00'} | Tokens: ${data.tokens_used || 0}</div>`;
}
// Render ad copy variations
if (data.ad_copy?.variations?.length > 0) {
  resultDiv.innerHTML += '<h3 style="font-size:16px;font-weight:700;margin:16px 0 12px;">Ad Copy Variations</h3>';
  data.ad_copy.variations.forEach((ad, i) => {
    resultDiv.innerHTML += `
    <div style="background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:20px;margin-bottom:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <span style="font-weight:700;font-size:14px;">Variation ${i+1}</span>
        <div style="display:flex;gap:6px;">
          ${(ad.triggers_used||[]).map(t => `<span style="padding:2px 8px;background:#fef3c7;color:#92400e;border-radius:8px;font-size:11px;">${t}</span>`).join('')}
        </div>
      </div>
      <div style="background:#fefce8;padding:10px 14px;border-radius:6px;font-weight:600;margin-bottom:10px;font-size:15px;">${ad.hook||''}</div>
      <div style="white-space:pre-wrap;font-size:14px;line-height:1.6;margin-bottom:12px;color:#374151;">${ad.primary_text||''}</div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;padding-top:12px;border-top:1px solid #f3f4f6;">
        <div><div style="font-size:11px;color:#6b7280;text-transform:uppercase;">Headline</div><div style="font-weight:600;font-size:13px;">${ad.headline||''}</div></div>
        <div><div style="font-size:11px;color:#6b7280;text-transform:uppercase;">Description</div><div style="font-size:13px;">${ad.description||''}</div></div>
        <div><div style="font-size:11px;color:#6b7280;text-transform:uppercase;">CTA</div><div style="font-weight:600;color:#2563eb;font-size:13px;">${ad.cta||''}</div></div>
      </div>
    </div>`;
  });
}
// Render image prompts
if (data.image_prompts?.prompts?.length > 0) {
  resultDiv.innerHTML += '<h3 style="font-size:16px;font-weight:700;margin:16px 0 12px;">Image Prompts</h3>';
  data.image_prompts.prompts.forEach((p, i) => {
    const promptId = `img-prompt-${i}`;
    resultDiv.innerHTML += `
    <div style="background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:20px;margin-bottom:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div style="font-weight:700;">${p.concept||''}</div>
        <button onclick="generateNanoBananaImage('${promptId}', this)" style="padding:8px 16px;background:linear-gradient(135deg,#8b5cf6,#6d28d9);color:#fff;border:none;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px;transition:all 0.2s;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="m21 15-5-5L5 21"/></svg>
          Generate Image
        </button>
      </div>
      <div style="font-size:13px;color:#374151;background:#f9fafb;padding:12px;border-radius:6px;margin-bottom:8px;font-family:monospace;" id="${promptId}-text">${p.prompt||''}</div>
      <div style="font-size:12px;color:#6b7280;font-style:italic;margin-bottom:8px;">${p.rationale||''}</div>
      <div id="${promptId}-result" style="display:none;margin-top:12px;"></div>
    </div>`;
  });
}
// Render email sequence
if (data.email_sequence?.sequence?.length > 0) {
  resultDiv.innerHTML += '<h3 style="font-size:16px;font-weight:700;margin:16px 0 12px;">Email Sequence</h3>';
  if (data.email_sequence.strategy) {
    resultDiv.innerHTML += `<div style="padding:12px;background:#f0fdf4;border-radius:8px;font-size:13px;color:#166534;margin-bottom:12px;">${data.email_sequence.strategy}</div>`;
  }
  data.email_sequence.sequence.forEach(email => {
    resultDiv.innerHTML += `
    <div style="background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:20px;margin-bottom:12px;position:relative;">
      <div style="position:absolute;top:12px;right:16px;padding:4px 10px;background:#dbeafe;color:#1e40af;border-radius:12px;font-size:11px;font-weight:600;">Day ${email.send_day}</div>
      <div style="font-size:12px;color:#6b7280;margin-bottom:4px;">Email ${email.email_number} ¬∑ ${email.awareness_level || ''}</div>
      <div style="font-weight:700;font-size:15px;margin-bottom:4px;">${email.subject_line||''}</div>
      <div style="font-size:12px;color:#9ca3af;margin-bottom:12px;">${email.preview_text||''}</div>
      <div style="white-space:pre-wrap;font-size:13px;line-height:1.6;color:#374151;max-height:200px;overflow-y:auto;padding:12px;background:#f9fafb;border-radius:6px;">${email.body||''}</div>
      <div style="margin-top:10px;display:flex;justify-content:space-between;align-items:center;">
        <span style="font-weight:600;color:#2563eb;font-size:13px;">${email.cta_text||''}</span>
        <div style="display:flex;gap:4px;">${(email.triggers_used||[]).map(t => `<span style="padding:2px 6px;background:#fef3c7;color:#92400e;border-radius:6px;font-size:10px;">${t}</span>`).join('')}</div>
      </div>
    </div>`;
  });
  if (data.email_sequence.expected_metrics) {
    const m = data.email_sequence.expected_metrics;
    resultDiv.innerHTML += `
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px;">
      <div style="text-align:center;padding:16px;background:#f9fafb;border-radius:8px;"><div style="font-size:1.5rem;font-weight:800;color:#10b981;">${m.estimated_open_rate||'--'}</div><div style="font-size:12px;color:#6b7280;">Est. Open Rate</div></div>
      <div style="text-align:center;padding:16px;background:#f9fafb;border-radius:8px;"><div style="font-size:1.5rem;font-weight:800;color:#2563eb;">${m.estimated_click_rate||'--'}</div><div style="font-size:12px;color:#6b7280;">Est. Click Rate</div></div>
      <div style="text-align:center;padding:16px;background:#f9fafb;border-radius:8px;"><div style="font-size:1.5rem;font-weight:800;color:#7c3aed;">${m.optimal_send_time||'--'}</div><div style="font-size:12px;color:#6b7280;">Best Send Time</div></div>
    </div>`;
  }
}
// No results at all
if (!data.ad_copy?.variations?.length && !data.image_prompts?.prompts?.length && !data.email_sequence?.sequence?.length) {
  resultDiv.innerHTML += '<div style="color:#6b7280;text-align:center;padding:32px;">No results generated. Try again.</div>';
}
})
.catch(err =>{
console.error('Failed to generate ads:', err);
resultDiv.innerHTML = '<div style="color:#ef4444;text-align:center;padding:32px;">Failed to generate: ' + err.message + '</div>';
});
}
function renderReports(container){
const html = `
<div style="background-color:#ffffff;border:1px solid #e5e7eb;border-radius:12px;padding:24px;">
<h2 style="font-size:20px;font-weight:700;margin-bottom:24px;">Performance Reports</h2>
<div class="stats-grid">
<div class="stat-card">
<div class="stat-label">Total Revenue</div>
<div class="stat-value">$24,500</div>
<div class="stat-change">+23% vs last month</div>
</div>
<div class="stat-card">
<div class="stat-label">Conversion Rate</div>
<div class="stat-value">4.2%</div>
<div class="stat-change">+0.8% vs last month</div>
</div>
<div class="stat-card">
<div class="stat-label">Cost Per Lead</div>
<div class="stat-value">$12.50</div>
<div class="stat-change">-$2 vs last month</div>
</div>
<div class="stat-card">
<div class="stat-label">ROI</div>
<div class="stat-value">340%</div>
<div class="stat-change">+45% vs last month</div>
</div>
</div>
<h3 style="font-size:16px;font-weight:700;margin-top:32px;margin-bottom:16px;">Top Performing Pages</h3>
<div class="table-container">
<table>
<thead>
<tr>
<th>Page</th>
<th>Views</th>
<th>Leads</th>
<th>Conv. Rate</th>
<th>Revenue</th>
</tr>
</thead>
<tbody>
${app.pages.slice(0, 5).map(page =>{
const conv = page.views > 0 ? ((page.leads / page.views) * 100).toFixed(1):'0';
return `
<tr>
<td><strong>${page.name}</strong></td>
<td>${page.views || 0}</td>
<td>${page.leads || 0}</td>
<td>${conv}%</td>
<td>$${(Math.random() * 10000).toFixed(2)}</td>
</tr>
`;
}).join('')}
</tbody>
</table>
</div>
</div>
`;
container.innerHTML = html;
}
function renderLeads(container, headerActions){
const html = `
<div style="margin-bottom:24px;display:flex;gap:12px;">
<select id="leadsFilter" style="padding:10px 12px;border:1px solid #e5e7eb;border-radius:8px;font-size:14px;">
<option value="">All Pages</option>
${app.pages.map(page => `<option value="${page.id}">${page.name}</option>`).join('')}
</select>
<button class="btn btn-secondary" onclick="exportLeads()">üì• Export CSV</button>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>Date</th>
<th>Page</th>
<th>Name</th>
<th>Email</th>
<th>Phone</th>
<th>UTM Source</th>
</tr>
</thead>
<tbody id="leadsTable">
</tbody>
</table>
</div>
`;
container.innerHTML = html;
loadLeadsTable();
}
function loadLeadsTable(){
fetch('/api/leads')
.then(res => res.json())
.then(data =>{
const tbody = document.getElementById('leadsTable');
tbody.innerHTML = '';
if (!data.leads || data.leads.length === 0){
tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:32px;color:#6b7280;">No leads yet</td></tr>';
return;
}
data.leads.forEach(lead =>{
const row = document.createElement('tr');
row.innerHTML = `
<td style="font-size:13px;color:#6b7280;">${new Date(lead.createdAt).toLocaleDateString()}</td>
<td>${lead.pageName || '‚Äî'}</td>
<td><strong>${lead.name}</strong></td>
<td style="font-size:13px;color:#2563eb;">${lead.email}</td>
<td style="font-size:13px;">${lead.phone || '‚Äî'}</td>
<td style="font-size:13px;color:#6b7280;">${lead.utmSource || '‚Äî'}</td>
`;
tbody.appendChild(row);
});
})
.catch(err => console.error('Failed to load leads:', err));
}
function exportLeads(){
window.location.href = '/api/leads/export';
}
function editPage(pageId){
openHtmlEditor(pageId);
}
function openHtmlEditor(pageId){
const page = app.pages.find(p => p.id === pageId);
if (!page) return;
app.currentPage = page;
const editor = document.getElementById('htmlEditorCode');
const preview = document.getElementById('htmlEditorPreview');
fetch(`/api/pages/${pageId}`)
.then(res => res.json())
.then(data =>{
editor.value = data.html || '';
updatePreview();
openModal('editPageModal');
})
.catch(err => console.error('Failed to load page:', err));
editor.addEventListener('input', updatePreview);
}
function updatePreview(){
const code = document.getElementById('htmlEditorCode').value;
const preview = document.getElementById('htmlEditorPreview');
try{
preview.srcdoc = code;
}catch (err){
console.error('Failed to update preview:', err);
}
}
function savePage(){
const html = document.getElementById('htmlEditorCode').value;
const pageId = app.currentPage.id;
fetch(`/api/pages/${pageId}`,{
method:'PUT',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({html})
})
.then(res => res.json())
.then(data =>{
deployPage(pageId);
})
.catch(err => console.error('Failed to save page:', err));
}
function generateVariants(pageId){
const page = app.pages.find(p => p.id === pageId);
if (!page) return alert('Page not found');
if (!confirm(`Generate A/B variants for "${page.name}"?\n\nThis will create 3 variants:\n- Alternate Layout\n- Dark Theme\n- Urgency Focused`)) return;
fetch(`/api/variants/${pageId}/generate`, {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({ variant_types: ['alternate-layout', 'dark-theme', 'urgency-focused'] })
})
.then(res => res.json())
.then(data => {
  if (data.success) {
    alert(`Created ${data.variants_created} variants for "${page.name}"!`);
    loadPages();
  } else {
    alert('Failed: ' + (data.error || 'Unknown error'));
  }
})
.catch(err => alert('Error: ' + err.message));
}
function viewPageAnalytics(pageId){
app.currentPage = app.pages.find(p => p.id === pageId);
openModal('pageAnalyticsModal');
loadPageAnalytics(pageId);
}
function loadPageAnalytics(pageId){
fetch(`/api/pages/${pageId}/analytics`)
.then(res => res.json())
.then(data =>{
renderAnalyticsCharts(data);
})
.catch(err => console.error('Failed to load analytics:', err));
}
function renderAnalyticsCharts(data){
const viewsChart = document.getElementById('viewsChart');
viewsChart.innerHTML = '';
const viewsData = data.dailyViews || [45, 52, 48, 61, 55, 67, 72];
const maxViews = Math.max(...viewsData);
viewsData.forEach((value, i) =>{
const item = document.createElement('div');
item.className = 'chart-bar-item';
item.innerHTML = `
<div class="chart-bar-value" style="height:${(value / maxViews) * 180}px;" title="${value}"></div>
<div class="chart-bar-label">Day ${i + 1}</div>
`;
viewsChart.appendChild(item);
});
const leadsChart = document.getElementById('leadsChart');
leadsChart.innerHTML = '';
const leadsData = data.dailyLeads || [5, 8, 6, 12, 9, 15, 18];
const maxLeads = Math.max(...leadsData);
leadsData.forEach((value, i) =>{
const item = document.createElement('div');
item.className = 'chart-bar-item';
item.innerHTML = `
<div class="chart-bar-value" style="height:${(value / maxLeads) * 180}px;background-color:#10b981;" title="${value}"></div>
<div class="chart-bar-label">Day ${i + 1}</div>
`;
leadsChart.appendChild(item);
});
const trafficTable = document.getElementById('trafficSourcesTable');
const sources = data.trafficSources || [
{name:'Google Ads', visits:1250},
{name:'Facebook', visits:980},
{name:'Direct', visits:450}
];
trafficTable.innerHTML = sources.map(s => `
<tr><td style="padding:8px 0;">${s.name}</td><td style="text-align:right;padding:8px 0;">${s.visits}</td></tr>
`).join('');
}
function setAnalyticsPeriod(period){
loadPageAnalytics(app.currentPage.id);
}
function deletePage(pageId){
if (!confirm('Are you sure you want to delete this page?')) return;
fetch(`/api/pages/${pageId}`,{method:'DELETE'})
.then(res => res.json())
.then(data =>{
loadPages();
renderDashboard(document.getElementById('contentArea'), document.getElementById('headerActions'));
alert('Page deleted');
})
.catch(err => console.error('Failed to delete page:', err));
}
function deleteClient(clientId){
if (!confirm('Are you sure you want to delete this client?')) return;
fetch(`/api/clients/${clientId}`,{method:'DELETE'})
.then(res => res.json())
.then(data =>{
loadClients();
loadClientsForSelects();
renderAllClients(document.getElementById('contentArea'), document.getElementById('headerActions'));
alert('Client deleted');
})
.catch(err => console.error('Failed to delete client:', err));
}
function deployPage(pageId){
fetch(`/api/pages/${pageId}/deploy`,{method:'POST'})
.then(res => res.json())
.then(data =>{
closeModal('editPageModal');
loadPages();
renderDashboard(document.getElementById('contentArea'), document.getElementById('headerActions'));
alert('Page saved and deployed!');
})
.catch(err => console.error('Failed to deploy page:', err));
}
function selectPageType(element, type){
document.querySelectorAll('.card-option').forEach(el => el.classList.remove('selected'));
element.classList.add('selected');
app.selectedPageType = type;
}
// 7-Step Pipeline Generation
const PIPELINE_STEPS = ['research', 'brand', 'strategy', 'copy', 'design', 'factcheck', 'assembly'];
let currentJobId = null;
let pipelineRunning = false;

function generatePage(){
if (!app.selectedPageType){
alert('Please select a page type');
return;
}
const btn = document.getElementById('generatePageBtn');
btn.disabled = true;
btn.style.display = 'none';
document.getElementById('pipelineProgress').style.display = 'block';

const payload = {
pageType: app.selectedPageType,
url: document.getElementById('generatePageUrl').value,
audience: document.getElementById('generatePageAudience').value,
tone: document.getElementById('generatePageTone').value,
clientId: document.getElementById('generatePageClient').value || null
};

// Reset pipeline UI
resetPipelineUI();
pipelineRunning = true;

// Start the pipeline
fetch('/api/pipeline/start', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(payload)
})
.then(res => res.json())
.then(data => {
if (!data.success || !data.jobId) {
throw new Error(data.error || 'Failed to start pipeline');
}
currentJobId = data.jobId;
// Run steps sequentially
runPipelineSteps(data.jobId, payload);
})
.catch(err => {
console.error('Pipeline start failed:', err);
pipelineRunning = false;
btn.disabled = false;
btn.style.display = '';
document.getElementById('pipelineProgress').style.display = 'none';
alert('Failed to start generation: ' + err.message);
});
}

async function runPipelineSteps(jobId, payload) {
let totalTokens = 0;
for (let i = 0; i < PIPELINE_STEPS.length; i++) {
if (!pipelineRunning) return;
const step = PIPELINE_STEPS[i];
updateStepUI(step, 'running');
updatePipelineProgress((i / PIPELINE_STEPS.length) * 100, `Running: ${getStepLabel(step)}...`);

try {
const resp = await fetch(`/api/pipeline/${jobId}/step/${step}`, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ url: payload.url, productName: payload.productName })
});
const result = await resp.json();
if (!result.success) throw new Error(result.error || `Step ${step} failed`);
totalTokens += (result.tokensUsed || 0);
updateStepUI(step, 'complete');
updatePipelineProgress(((i + 1) / PIPELINE_STEPS.length) * 100, `Completed: ${getStepLabel(step)}`);
document.getElementById('pipelineCost').textContent = `Tokens: ${totalTokens.toLocaleString()} | Est. cost: $${((totalTokens / 1000000) * 9).toFixed(4)}`;

// If assembly is done, show success
if (step === 'assembly' && result.data) {
pipelineComplete(result.data);
}
} catch (err) {
console.error(`Step ${step} failed:`, err);
updateStepUI(step, 'failed');
updatePipelineProgress(0, `Failed at: ${getStepLabel(step)} - ${err.message}`);
pipelineRunning = false;
document.getElementById('generatePageBtn').disabled = false;
document.getElementById('generatePageBtn').style.display = '';
document.getElementById('generatePageBtn').innerHTML = '<span>Retry</span>';
return;
}
}
}

function pipelineComplete(assemblyData) {
pipelineRunning = false;
updatePipelineProgress(100, 'Generation complete!');
document.getElementById('pipelineStatus').innerHTML = `<strong style="color:#16a34a;">Page generated successfully!</strong>`;
loadPages();
loadStats();
setTimeout(() => {
closeModal('generatePageModal');
document.getElementById('generatePageBtn').disabled = false;
document.getElementById('generatePageBtn').style.display = '';
document.getElementById('generatePageBtn').innerHTML = '<span>Generate Page</span>';
document.getElementById('pipelineProgress').style.display = 'none';
resetPipelineUI();
}, 2000);
}

function resetPipelineUI() {
PIPELINE_STEPS.forEach(step => updateStepUI(step, 'waiting'));
document.getElementById('pipelineProgressFill').style.width = '0%';
document.getElementById('pipelineStatus').textContent = '';
document.getElementById('pipelineCost').textContent = '';
}

function updateStepUI(step, status) {
const el = document.querySelector(`.pipeline-step[data-step="${step}"]`);
if (!el) return;
const statusEl = el.querySelector('.step-status');
el.style.opacity = status === 'waiting' ? '0.5' : '1';
el.style.background = status === 'running' ? '#eff6ff' : status === 'complete' ? '#f0fdf4' : status === 'failed' ? '#fef2f2' : 'transparent';
el.style.borderRadius = '8px';
el.style.padding = '8px 12px';
if (status === 'waiting') statusEl.textContent = 'Waiting';
else if (status === 'running') { statusEl.innerHTML = '<span class="loading" style="width:14px;height:14px;"></span> Running'; statusEl.style.color = '#2563eb'; }
else if (status === 'complete') { statusEl.textContent = '‚úì Done'; statusEl.style.color = '#16a34a'; }
else if (status === 'failed') { statusEl.textContent = '‚úó Failed'; statusEl.style.color = '#dc2626'; }
}

function updatePipelineProgress(percent, statusText) {
document.getElementById('pipelineProgressFill').style.width = percent + '%';
if (statusText) document.getElementById('pipelineStatus').textContent = statusText;
}

function getStepLabel(step) {
const labels = {
research: 'Deep Research', brand: 'Brand Extraction', strategy: 'Page Strategy',
copy: 'Copy Generation', design: 'Design Generation', factcheck: 'Fact Checking', assembly: 'Final Assembly'
};
return labels[step] || step;
}
function importHtml(){
const pageName = document.getElementById('importPageName').value;
const clientId = document.getElementById('importClient').value;
const htmlCode = document.getElementById('importHtmlCode').value;
if (!pageName){
alert('Page name is required');
return;
}
if (!htmlCode){
alert('HTML code is required');
return;
}
fetch('/api/pages',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
name:pageName,
clientId:clientId || null,
html:htmlCode
})
})
.then(res => res.json())
.then(data =>{
closeModal('importHtmlModal');
loadPages();
if (data.id){
deployPage(data.id);
}
alert('Page imported and deployed!');
})
.catch(err =>{
console.error('Failed to import page:', err);
alert('Failed to import page');
});
}
function saveBrandGuide(clientId){
const styleGuide = {
  colors: {
    primary: document.getElementById('colorPrimary')?.value || '#2563eb',
    secondary: document.getElementById('colorSecondary')?.value || '#10b981',
    accent: document.getElementById('colorAccent')?.value || '#f59e0b',
    background: document.getElementById('colorBackground')?.value || '#ffffff',
    text: document.getElementById('colorText')?.value || '#1e293b'
  },
  typography: {
    headingFont: document.getElementById('bgHeadingFont')?.value || 'Inter',
    bodyFont: document.getElementById('bgBodyFont')?.value || 'Inter'
  },
  layout: {
    borderRadius: document.getElementById('bgBorderRadius')?.value || '8',
    spacingUnit: document.getElementById('bgSpacingUnit')?.value || '8',
    maxWidth: document.getElementById('bgMaxWidth')?.value || '800'
  },
  buttons: {
    shape: document.getElementById('bgButtonShape')?.value || 'rounded',
    style: document.getElementById('bgButtonStyle')?.value || 'solid'
  },
  voice: {
    tone: document.getElementById('bgVoiceTone')?.value || 'professional',
    keywords: document.getElementById('bgBrandKeywords')?.value || ''
  }
};
fetch(`/api/clients/${clientId}/style-guide`, {
  method: 'PUT',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(styleGuide)
})
.then(res => res.json())
.then(() => alert('Brand guide saved!'))
.catch(err => console.error('Failed to save brand guide:', err));
}

function updateResearch(clientId) {
  const updates = {
    tagline: document.getElementById('resTagline')?.value || '',
    industry: document.getElementById('resIndustry')?.value || '',
    brandVoice: document.getElementById('resBrandVoice')?.value || '',
    valuePropositions: (document.getElementById('resValueProps')?.value || '').split('\n').filter(v => v.trim()),
    differentiators: (document.getElementById('resDifferentiators')?.value || '').split('\n').filter(v => v.trim())
  };
  fetch(`/api/clients/${clientId}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(updates)
  }).catch(err => console.error('Failed to update research:', err));
}

function addProduct(clientId) {
  const name = prompt('Product/Service Name:');
  if (!name) return;
  const description = prompt('Brief Description:') || '';
  const price = prompt('Price (optional):') || '';
  const featuresRaw = prompt('Key Features (comma-separated, optional):') || '';
  const features = featuresRaw.split(',').map(f => f.trim()).filter(Boolean);
  fetch(`/api/clients/${clientId}/products`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, description, price, features })
  })
  .then(res => res.json())
  .then(() => { showClientDetail(clientId); })
  .catch(err => console.error('Failed to add product:', err));
}

function removeProduct(clientId, index) {
  if (!confirm('Remove this product?')) return;
  fetch(`/api/clients/${clientId}`)
  .then(res => res.json())
  .then(client => {
    const products = client.products || [];
    products.splice(index, 1);
    return fetch(`/api/clients/${clientId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ products })
    });
  })
  .then(() => showClientDetail(clientId))
  .catch(err => console.error('Failed to remove product:', err));
}

function addAudience(clientId) {
  const name = prompt('Audience Name (e.g., "Health-conscious women 35-55"):');
  if (!name) return;
  const description = prompt('Description:') || '';
  const painPointsRaw = prompt('Pain Points (comma-separated):') || '';
  const painPoints = painPointsRaw.split(',').map(p => p.trim()).filter(Boolean);
  fetch(`/api/clients/${clientId}/audiences`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, description, painPoints })
  })
  .then(res => res.json())
  .then(() => showClientDetail(clientId))
  .catch(err => console.error('Failed to add audience:', err));
}

function removeAudience(clientId, index) {
  if (!confirm('Remove this audience?')) return;
  fetch(`/api/clients/${clientId}`)
  .then(res => res.json())
  .then(client => {
    const audiences = client.audiences || [];
    audiences.splice(index, 1);
    return fetch(`/api/clients/${clientId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ audiences })
    });
  })
  .then(() => showClientDetail(clientId))
  .catch(err => console.error('Failed to remove audience:', err));
}

function addVerifiedClaim(clientId) {
  const text = prompt('Claim/Testimonial/Statistic text:');
  if (!text) return;
  const category = prompt('Category (CLAIM, TESTIMONIAL, or STATISTIC):') || 'CLAIM';
  const source = prompt('Source URL (optional):') || '';
  fetch(`/api/clients/${clientId}/claims`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ text, category: category.toUpperCase(), source })
  })
  .then(res => res.json())
  .then(() => showClientDetail(clientId))
  .catch(err => console.error('Failed to add claim:', err));
}

function removeClaim(clientId, index) {
  if (!confirm('Remove this verified claim?')) return;
  fetch(`/api/clients/${clientId}`)
  .then(res => res.json())
  .then(client => {
    const claims = client.claims || [];
    claims.splice(index, 1);
    return fetch(`/api/clients/${clientId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ claims })
    });
  })
  .then(() => showClientDetail(clientId))
  .catch(err => console.error('Failed to remove claim:', err));
}

function filterClaims(category) {
  document.querySelectorAll('.claim-filter').forEach(btn => {
    btn.classList.remove('active');
    btn.style.background = '#fff';
  });
  event.target.classList.add('active');
  event.target.style.background = '#f1f5f9';
  document.querySelectorAll('.claim-item').forEach(el => {
    if (category === 'all' || el.dataset.category === category) {
      el.style.display = 'block';
    } else {
      el.style.display = 'none';
    }
  });
}

async function scrapeVerifiedClaims(clientId) {
  const client = app.clients.find(c => c.id === clientId);
  if (!client?.website) { alert('No website URL set for this client. Add one first.'); return; }
  const btn = event.target;
  btn.disabled = true;
  btn.textContent = 'Scraping...';
  try {
    const response = await fetch('/api/pipeline', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        action: 'scrape-claims',
        clientId: clientId,
        url: client.website
      })
    });
    const data = await response.json();
    if (data.claims && data.claims.length > 0) {
      alert('Found ' + data.claims.length + ' verified claims!');
      showClientDetail(clientId);
    } else {
      alert('No claims found on the website. Try adding them manually.');
    }
  } catch (err) {
    console.error('Scrape failed:', err);
    alert('Failed to scrape claims: ' + err.message);
  }
  btn.disabled = false;
  btn.textContent = 'Scrape from Website';
}
async function rescrapeImages(clientId, website) {
  if (!website) { alert('No website URL set for this client.'); return; }
  const btn = event.target;
  btn.disabled = true;
  btn.textContent = 'Scraping images...';
  try {
    const response = await fetch('/api/pipeline', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: 'scrape-images', clientId, url: website })
    });
    const data = await response.json();
    if (data.images && data.images.length > 0) {
      alert('Found ' + data.images.length + ' images!');
      showClientDetail(clientId);
    } else {
      alert('No usable images found on the website.');
    }
  } catch (err) {
    console.error('Image scrape failed:', err);
    alert('Failed to scrape images: ' + err.message);
  }
  btn.disabled = false;
  btn.textContent = 'Re-scrape Images';
}
function selectAssetImage(el) {
  el.classList.toggle('selected');
  el.style.outline = el.classList.contains('selected') ? '3px solid #6366f1' : 'none';
}
let currentQualityRating = 0;
let reviewingPageId = null;
function openQualityReview(pageId) {
  reviewingPageId = pageId;
  currentQualityRating = 0;
  document.querySelectorAll('.quality-star').forEach(s => s.style.opacity = '0.3');
  document.getElementById('qualityRatingLabel').textContent = '';
  document.getElementById('qHeadline').value = '';
  document.getElementById('qCopy').value = '';
  document.getElementById('qDesign').value = '';
  document.getElementById('qCTA').value = '';
  document.getElementById('qIssues').value = '';
  document.getElementById('qSuggestions').value = '';
  document.getElementById('qUnicornCompare').value = '';
  openModal('qualityReviewModal');
}
function setQualityRating(rating) {
  currentQualityRating = rating;
  const labels = ['', 'Poor ‚Äî Major issues', 'Below Average ‚Äî Needs work', 'Average ‚Äî Acceptable', 'Good ‚Äî Solid output', 'Excellent ‚Äî Unicorn-quality'];
  document.getElementById('qualityRatingLabel').textContent = labels[rating] || '';
  document.querySelectorAll('.quality-star').forEach((s, i) => {
    s.style.opacity = i < rating ? '1' : '0.3';
  });
}
async function submitQualityReview() {
  if (!currentQualityRating) { alert('Please set an overall quality rating.'); return; }
  const review = {
    pageId: reviewingPageId,
    overall: currentQualityRating,
    headline: parseInt(document.getElementById('qHeadline').value) || null,
    copy: parseInt(document.getElementById('qCopy').value) || null,
    design: parseInt(document.getElementById('qDesign').value) || null,
    cta: parseInt(document.getElementById('qCTA').value) || null,
    issues: document.getElementById('qIssues').value.trim().split('\n').filter(Boolean),
    suggestions: document.getElementById('qSuggestions').value.trim().split('\n').filter(Boolean),
    unicornCompare: document.getElementById('qUnicornCompare').value,
    timestamp: new Date().toISOString()
  };
  try {
    const page = app.pages.find(p => p.id === reviewingPageId);
    if (page) {
      const reviews = page.quality_reviews || [];
      reviews.push(review);
      await fetch(`/api/pages/${reviewingPageId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ quality_reviews: reviews, quality_score: currentQualityRating })
      });
      page.quality_reviews = reviews;
      page.quality_score = currentQualityRating;
    }
    closeModal('qualityReviewModal');
    alert('Quality review saved! Average score: ' + currentQualityRating + '/5');
  } catch (err) {
    console.error('Failed to save review:', err);
    alert('Failed to save review: ' + err.message);
  }
}
function toggleChatPanel(){
document.getElementById('chatPanel').classList.toggle('active');
}
function sendChatMessage(){
const input = document.getElementById('chatInput');
const message = input.value.trim();
if (!message) return;
const messagesDiv = document.getElementById('chatMessages');
const userMsg = document.createElement('div');
userMsg.className = 'chat-message user';
userMsg.innerHTML = `<div class="chat-message-bubble">${message}</div>`;
messagesDiv.appendChild(userMsg);
messagesDiv.scrollTop = messagesDiv.scrollHeight;
input.value = '';
fetch('/api/chat',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
message,
pageId:app.currentPage?.id,
context:document.getElementById('htmlEditorCode')?.value
})
})
.then(res => res.json())
.then(data =>{
const assistantMsg = document.createElement('div');
assistantMsg.className = 'chat-message assistant';
assistantMsg.innerHTML = `<div class="chat-message-bubble">${data.response}</div>`;
messagesDiv.appendChild(assistantMsg);
messagesDiv.scrollTop = messagesDiv.scrollHeight;
})
.catch(err => console.error('Failed to send message:', err));
}
function openModal(modalId){
document.getElementById(modalId).classList.add('active');
}
function closeModal(modalId){
document.getElementById(modalId).classList.remove('active');
document.querySelectorAll(`#${modalId}input[type="text"], #${modalId}textarea, #${modalId}select`).forEach(el =>{
el.value = '';
});
document.querySelectorAll(`#${modalId}.card-option`).forEach(el =>{
el.classList.remove('selected');
});
}
function copyToClipboard(text){
navigator.clipboard.writeText(text).then(() =>{
alert('Copied to clipboard!');
});
}
function exportAd(index){
alert(`Ad #${index + 1}exported`);
}
document.querySelectorAll('.modal-overlay').forEach(overlay =>{
overlay.addEventListener('click', (e) =>{
if (e.target === overlay){
overlay.classList.remove('active');
}
});
});
</script>
</body>
</html>